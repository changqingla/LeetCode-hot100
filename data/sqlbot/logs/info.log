2025-12-16 15:28:03,943 - fastapi_mcp.server - INFO:297 - No auth config provided, skipping auth setup
2025-12-16 15:28:03,943 - fastapi_mcp.server - INFO:368 - MCP server listening at /mcp
2025-12-16 15:28:03,947 - fastapi_mcp.server - INFO:297 - No auth config provided, skipping auth setup
2025-12-16 15:28:03,947 - fastapi_mcp.server - INFO:368 - MCP server listening at /mcp
2025-12-16 15:28:04,171 - sqlbot_xpack.core - INFO:52 - XPack core initialized successfully.
2025-12-16 15:28:04,202 - sqlbot_xpack.core - INFO:52 - XPack core initialized successfully.
2025-12-16 15:28:04,224 - alembic.runtime.migration - INFO:211 - Context impl PostgresqlImpl.
2025-12-16 15:28:04,224 - alembic.runtime.migration - INFO:214 - Will assume transactional DDL.
2025-12-16 15:28:04,262 - alembic.runtime.migration - INFO:622 - Running upgrade  -> 5348b743b05f, 001_ddl
2025-12-16 15:28:04,275 - alembic.runtime.migration - INFO:622 - Running upgrade 5348b743b05f -> 1c8bcc7e25c8, 002_ddl_autogenerate
2025-12-16 15:28:04,283 - alembic.runtime.migration - INFO:622 - Running upgrade 1c8bcc7e25c8 -> d116056121c3, 003 add datasource
2025-12-16 15:28:04,288 - alembic.runtime.migration - INFO:622 - Running upgrade d116056121c3 -> 8fe654655905, 004_add_aimodel_auto
2025-12-16 15:28:04,297 - alembic.runtime.migration - INFO:622 - Running upgrade 8fe654655905 -> 0a6f11be9be4, 005_table_and_field
2025-12-16 15:28:04,308 - alembic.runtime.migration - INFO:622 - Running upgrade 0a6f11be9be4 -> e6276ddab06e, 006_add_ds_field
2025-12-16 15:28:04,312 - alembic.runtime.migration - INFO:622 - Running upgrade e6276ddab06e -> ff653d5df198, 006_add_chat
2025-12-16 15:28:04,322 - alembic.runtime.migration - INFO:622 - Running upgrade ff653d5df198 -> 35d925df4568, 008_modify_field_type
2025-12-16 15:28:04,327 - alembic.runtime.migration - INFO:622 - Running upgrade 35d925df4568 -> 1f077c30e476, 009_modify_chat
2025-12-16 15:28:04,338 - alembic.runtime.migration - INFO:622 - Running upgrade 1f077c30e476 -> 804b08ac329d, core_dashboard
2025-12-16 15:28:04,345 - alembic.runtime.migration - INFO:622 - Running upgrade 804b08ac329d -> 8dc3b1bdbfef, 010_upgrade_user_language
2025-12-16 15:28:04,675 - alembic.runtime.migration - INFO:622 - Running upgrade 8dc3b1bdbfef -> 941e2355a94d, msg...
2025-12-16 15:28:04,679 - alembic.runtime.migration - INFO:622 - Running upgrade 941e2355a94d -> a3af70d43e98, 011_license_ddl
2025-12-16 15:28:04,686 - alembic.runtime.migration - INFO:622 - Running upgrade a3af70d43e98 -> bfa10ce83d73, 010_modify_chat
2025-12-16 15:28:04,693 - alembic.runtime.migration - INFO:622 - Running upgrade bfa10ce83d73 -> fde8acca6143, modify_chat_record
2025-12-16 15:28:04,696 - alembic.runtime.migration - INFO:622 - Running upgrade fde8acca6143 -> 02d84523a979, 015_modify_chat
2025-12-16 15:28:04,699 - alembic.runtime.migration - INFO:622 - Running upgrade 02d84523a979 -> 031148da1d81, 016_modify_chat
2025-12-16 15:28:04,716 - alembic.runtime.migration - INFO:622 - Running upgrade 031148da1d81 -> a0ba8268868d, 017_rsa_ddl
2025-12-16 15:28:04,722 - alembic.runtime.migration - INFO:622 - Running upgrade a0ba8268868d -> 863105882eba, 018_modify_chat
2025-12-16 15:28:04,743 - alembic.runtime.migration - INFO:622 - Running upgrade 863105882eba -> dcaecd481715, 019_upgrade_model
2025-12-16 15:28:04,753 - alembic.runtime.migration - INFO:622 - Running upgrade dcaecd481715 -> a6b44114c17f, 020_workspace_ddl
2025-12-16 15:28:04,760 - alembic.runtime.migration - INFO:622 - Running upgrade a6b44114c17f -> 440e9e41da3c, 021_user_ws_ddl
2025-12-16 15:28:04,767 - alembic.runtime.migration - INFO:622 - Running upgrade 440e9e41da3c -> e6b20ae73606, 022_assistant_ddl
2025-12-16 15:28:04,774 - alembic.runtime.migration - INFO:622 - Running upgrade e6b20ae73606 -> f535d09946f6, 023_modify_chat_record
2025-12-16 15:28:04,798 - alembic.runtime.migration - INFO:622 - Running upgrade f535d09946f6 -> 806bc67ff45f, 024_modify_chat_record
2025-12-16 15:28:04,803 - alembic.runtime.migration - INFO:622 - Running upgrade 806bc67ff45f -> 97dcdbedaaf3, 025_ds_num
2025-12-16 15:28:04,805 - alembic.runtime.migration - INFO:622 - Running upgrade 97dcdbedaaf3 -> 4c6d18a18bd4, 026_row_column_permission
2025-12-16 15:28:04,814 - alembic.runtime.migration - INFO:622 - Running upgrade 4c6d18a18bd4 -> b049c9f8ca5b, 027_modify_permission
2025-12-16 15:28:04,818 - alembic.runtime.migration - INFO:622 - Running upgrade b049c9f8ca5b -> e96b16d3daab, 028_ds_oid
2025-12-16 15:28:04,821 - alembic.runtime.migration - INFO:622 - Running upgrade e96b16d3daab -> 77d4c39ec22f, 029_modify_chat
2025-12-16 15:28:04,834 - alembic.runtime.migration - INFO:622 - Running upgrade 77d4c39ec22f -> c1d7ac00b3a8, 030_permission_oid
2025-12-16 15:28:04,841 - alembic.runtime.migration - INFO:622 - Running upgrade c1d7ac00b3a8 -> bd2ed188b5bd, 031_modify_chat_record
2025-12-16 15:28:04,843 - alembic.runtime.migration - INFO:622 - Running upgrade bd2ed188b5bd -> 6549e47f9adc, 032_modify_assistant_ddl
2025-12-16 15:28:04,846 - alembic.runtime.migration - INFO:622 - Running upgrade 6549e47f9adc -> 3cb5d6a54f2e, 033_chat_origin_ddl
2025-12-16 15:28:04,849 - alembic.runtime.migration - INFO:622 - Running upgrade 3cb5d6a54f2e -> e8b470d2b150, 034_field_sort
2025-12-16 15:28:04,851 - alembic.runtime.migration - INFO:622 - Running upgrade e8b470d2b150 -> 29559ee607af, 035_sys_arg_ddl
2025-12-16 15:28:04,863 - alembic.runtime.migration - INFO:622 - Running upgrade 29559ee607af -> 646e7ca28e0e, 036_modify_assistant
2025-12-16 15:28:04,868 - alembic.runtime.migration - INFO:622 - Running upgrade 646e7ca28e0e -> 68a06302cf70, 035_create_chat_log
2025-12-16 15:28:04,878 - alembic.runtime.migration - INFO:622 - Running upgrade 68a06302cf70 -> fc23c4f3e755, 038_remove_chat_record_cloumns
2025-12-16 15:28:04,889 - alembic.runtime.migration - INFO:622 - Running upgrade fc23c4f3e755 -> 25cbc85766fd, 039_create_terminology
2025-12-16 15:28:04,917 - alembic.runtime.migration - INFO:622 - Running upgrade 25cbc85766fd -> 0fc14c2cfe41, 040_modify_ai_model
2025-12-16 15:28:04,921 - alembic.runtime.migration - INFO:622 - Running upgrade 0fc14c2cfe41 -> c4c3c36b720d, 041_add_terminology_oid
2025-12-16 15:28:04,924 - alembic.runtime.migration - INFO:622 - Running upgrade c4c3c36b720d -> a487d9c69341, 042_data_training
2025-12-16 15:28:04,928 - alembic.runtime.migration - INFO:622 - Running upgrade a487d9c69341 -> dac062c1f7b1, 043_modify_ds_id_type
2025-12-16 15:28:04,941 - alembic.runtime.migration - INFO:622 - Running upgrade dac062c1f7b1 -> 455b8ce69e80, 044_table_relation
2025-12-16 15:28:04,944 - alembic.runtime.migration - INFO:622 - Running upgrade 455b8ce69e80 -> 45e7e52bf2b8, 045_modify_terminolog
2025-12-16 15:28:04,948 - alembic.runtime.migration - INFO:622 - Running upgrade 45e7e52bf2b8 -> 8855aea2dd61, 046_add_custom_prompt
2025-12-16 15:28:04,953 - alembic.runtime.migration - INFO:622 - Running upgrade 8855aea2dd61 -> c1b794a961ce, 047_table_embedding
2025-12-16 15:28:04,973 - common.core.sqlbot_cache - INFO:129 - SQLBot 使用内存缓存, 仅支持单进程模式
2025-12-16 15:28:04,993 - apps.datasource.crud.table - INFO:40 - get tables
2025-12-16 15:28:04,994 - main - INFO:51 - ✅ SQLBot 初始化完成
2025-12-16 15:28:05,009 - apps.datasource.crud.table - INFO:43 - table result: 0
2025-12-16 15:28:05,010 - apps.datasource.crud.table - INFO:46 - get datasource
2025-12-16 15:28:05,013 - apps.datasource.crud.table - INFO:49 - datasource result: 0
2025-12-16 15:28:05,758 - sqlbot_xpack.config.rsa_manage - INFO:119 - XPack global rsa cache clean successfully.
2025-12-16 15:32:01,218 - apps.db.db - INFO:145 - success
2025-12-16 15:32:02,880 - apps.db.db - INFO:145 - success
2025-12-16 15:32:08,354 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-16 15:32:08,360 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-16 15:32:10,816 - sentence_transformers.SentenceTransformer - INFO:227 - Load pretrained SentenceTransformer: /opt/sqlbot/models/embedding/shibing624_text2vec-base-chinese
2025-12-16 15:32:12,792 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 4.429259538650513 seconds
2025-12-16 15:32:12,795 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 4.440848112106323 seconds
2025-12-16 15:36:24,578 - httpx - INFO:1740 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:36:24,586 - apps.system.api.aimodel - INFO:32 - content='' additional_kwargs={} response_metadata={} id='run--e752ba87-9222-43e2-9abe-22ed0f5111d3'
2025-12-16 15:36:24,587 - apps.system.api.aimodel - INFO:32 - content='1' additional_kwargs={} response_metadata={} id='run--e752ba87-9222-43e2-9abe-22ed0f5111d3'
2025-12-16 15:36:24,925 - apps.system.api.aimodel - INFO:32 - content='+1=' additional_kwargs={} response_metadata={} id='run--e752ba87-9222-43e2-9abe-22ed0f5111d3'
2025-12-16 15:36:24,972 - apps.system.api.aimodel - INFO:32 - content='2' additional_kwargs={} response_metadata={} id='run--e752ba87-9222-43e2-9abe-22ed0f5111d3'
2025-12-16 15:36:25,000 - apps.system.api.aimodel - INFO:32 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--e752ba87-9222-43e2-9abe-22ed0f5111d3'
2025-12-16 15:36:25,004 - apps.system.api.aimodel - INFO:32 - content='' additional_kwargs={} response_metadata={} id='run--e752ba87-9222-43e2-9abe-22ed0f5111d3' usage_metadata={'input_tokens': 12, 'output_tokens': 5, 'total_tokens': 17, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:36:37,391 - apps.db.db - INFO:145 - success
2025-12-16 15:36:38,233 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:36:38,234 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:38,235 - apps.chat.task.llm - INFO:1374 - content='["' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:38,297 - apps.chat.task.llm - INFO:1374 - content='查询' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:38,359 - apps.chat.task.llm - INFO:1374 - content='所有案件数据' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:38,427 - apps.chat.task.llm - INFO:1374 - content='","使用柱' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:38,565 - apps.chat.task.llm - INFO:1374 - content='状图展示各' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:38,733 - apps.chat.task.llm - INFO:1374 - content='街道的案件数量","' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:39,609 - apps.chat.task.llm - INFO:1374 - content='使用折线图展示' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:39,879 - apps.chat.task.llm - INFO:1374 - content='每月案件上报趋势' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:40,214 - apps.chat.task.llm - INFO:1374 - content='","查询每个大' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:40,411 - apps.chat.task.llm - INFO:1374 - content='类名称下的案件数量"]' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:40,506 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--9e8c9558-0c1c-4492-8132-375fc1968794'
2025-12-16 15:36:40,508 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--9e8c9558-0c1c-4492-8132-375fc1968794' usage_metadata={'input_tokens': 1201, 'output_tokens': 36, 'total_tokens': 1237, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:36:51,789 - apps.datasource.embedding.table_embedding - INFO:71 - 0.13660693168640137
2025-12-16 15:36:51,789 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.46096791132682585}]
2025-12-16 15:36:52,101 - apps.db.db - INFO:145 - success
2025-12-16 15:36:53,706 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:36:53,708 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:53,708 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,057 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,133 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,161 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,282 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,365 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,491 - apps.chat.task.llm - INFO:1374 - content='region_name`, COUNT' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,587 - apps.chat.task.llm - INFO:1374 - content='(*) AS `case_count`' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,684 - apps.chat.task.llm - INFO:1374 - content=' FROM `hengqiang' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:54,918 - apps.chat.task.llm - INFO:1374 - content='_auth`.`digital_urban' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:55,075 - apps.chat.task.llm - INFO:1374 - content='_management_cases` WHERE `小' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:55,152 - apps.chat.task.llm - INFO:1374 - content="类名称` = '无" additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:55,262 - apps.chat.task.llm - INFO:1374 - content="照经营游商' GROUP" additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:55,412 - apps.chat.task.llm - INFO:1374 - content=' BY `区域名称` ORDER' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,263 - apps.chat.task.llm - INFO:1374 - content=' BY `case_count` DESC' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,343 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,465 - apps.chat.task.llm - INFO:1374 - content='000",\n' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,559 - apps.chat.task.llm - INFO:1374 - content='  "tables": ["digital' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,672 - apps.chat.task.llm - INFO:1374 - content='_urban_management_cases"],\n ' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,766 - apps.chat.task.llm - INFO:1374 - content=' "chart-type": "column' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,843 - apps.chat.task.llm - INFO:1374 - content='"\n}\n```' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,866 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd'
2025-12-16 15:36:56,868 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--d34f254f-5234-4a4e-85cb-48fa95f7a2dd' usage_metadata={'input_tokens': 4027, 'output_tokens': 104, 'total_tokens': 4131, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:36:56,890 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `region_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "column"
}
```
2025-12-16 15:36:56,896 - apps.chat.task.llm - INFO:1019 - sql: SELECT `区域名称` AS `region_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 15:36:56,906 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `区域名称` AS `region_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 15:36:59,806 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:36:59,807 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:36:59,808 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:36:59,963 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:00,015 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:00,156 - apps.chat.task.llm - INFO:1374 - content='": "column' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:00,893 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:00,969 - apps.chat.task.llm - INFO:1374 - content='无照经营游商案件' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,175 - apps.chat.task.llm - INFO:1374 - content='数量",\n  "axis":' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,254 - apps.chat.task.llm - INFO:1374 - content=' {\n    "x": {\n' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,421 - apps.chat.task.llm - INFO:1374 - content='      "name": "区域' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,478 - apps.chat.task.llm - INFO:1374 - content='名称",\n      "value":' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,576 - apps.chat.task.llm - INFO:1374 - content=' "region_name"\n   ' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,674 - apps.chat.task.llm - INFO:1374 - content=' },\n    "y": {\n' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,767 - apps.chat.task.llm - INFO:1374 - content='      "name": "案件' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,873 - apps.chat.task.llm - INFO:1374 - content='数量",\n      "value":' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:01,980 - apps.chat.task.llm - INFO:1374 - content=' "case_count"\n    }\n' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:02,044 - apps.chat.task.llm - INFO:1374 - content='  }\n}\n```' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:02,065 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a'
2025-12-16 15:37:02,066 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--a2d5b17b-a050-4f7b-b789-7aa5f2a6073a' usage_metadata={'input_tokens': 2219, 'output_tokens': 79, 'total_tokens': 2298, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:37:02,085 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "column",
  "title": "无照经营游商案件数量",
  "axis": {
    "x": {
      "name": "区域名称",
      "value": "region_name"
    },
    "y": {
      "name": "案件数量",
      "value": "case_count"
    }
  }
}
```
2025-12-16 15:37:02,092 - apps.chat.task.llm - INFO:1096 - {'type': 'column', 'title': '无照经营游商案件数量', 'axis': {'x': {'name': '区域名称', 'value': 'region_name'}, 'y': {'name': '案件数量', 'value': 'case_count'}}}
2025-12-16 15:37:02,868 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:37:02,871 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:02,871 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:02,908 - apps.chat.task.llm - INFO:1374 - content='json\n["' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:02,952 - apps.chat.task.llm - INFO:1374 - content='哪个街道' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:03,713 - apps.chat.task.llm - INFO:1374 - content='发生无照' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:04,496 - apps.chat.task.llm - INFO:1374 - content='经营游商案件最多，' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:04,604 - apps.chat.task.llm - INFO:1374 - content='发生了多少起",' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:04,704 - apps.chat.task.llm - INFO:1374 - content=' "无照经营游' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:04,758 - apps.chat.task.llm - INFO:1374 - content='商案件的上报' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:04,858 - apps.chat.task.llm - INFO:1374 - content='时间分布是怎样的' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:04,920 - apps.chat.task.llm - INFO:1374 - content='", "无照经营游' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:05,485 - apps.chat.task.llm - INFO:1374 - content='商案件在各' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:05,593 - apps.chat.task.llm - INFO:1374 - content='时间段的上报数量' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:05,701 - apps.chat.task.llm - INFO:1374 - content='是多少", "使用' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:05,808 - apps.chat.task.llm - INFO:1374 - content='柱状图展示各' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:05,912 - apps.chat.task.llm - INFO:1374 - content='区域无照经营游' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:06,345 - apps.chat.task.llm - INFO:1374 - content='商案件的数量"]\n```' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:06,367 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50'
2025-12-16 15:37:06,368 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--8e8a0d84-b352-403a-8394-8a4e8e9cac50' usage_metadata={'input_tokens': 1231, 'output_tokens': 66, 'total_tokens': 1297, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:37:26,949 - apps.datasource.embedding.table_embedding - INFO:71 - 0.12691664695739746
2025-12-16 15:37:26,950 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.46096791132682585}]
2025-12-16 15:37:27,267 - apps.db.db - INFO:145 - success
2025-12-16 15:37:27,811 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:37:27,813 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:27,813 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:28,285 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:28,394 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:28,451 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:28,625 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:28,772 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:29,065 - apps.chat.task.llm - INFO:1374 - content='district_name`, COUNT' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:29,217 - apps.chat.task.llm - INFO:1374 - content='(*) AS `case_count`' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:29,369 - apps.chat.task.llm - INFO:1374 - content=' FROM `hengqiang' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:29,587 - apps.chat.task.llm - INFO:1374 - content='_auth`.`digital_urban' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:29,769 - apps.chat.task.llm - INFO:1374 - content='_management_cases` WHERE `问题' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:29,879 - apps.chat.task.llm - INFO:1374 - content="类型` = '事件" additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:30,070 - apps.chat.task.llm - INFO:1374 - content="' AND `小" additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:30,229 - apps.chat.task.llm - INFO:1374 - content="类名称` = '无" additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:30,411 - apps.chat.task.llm - INFO:1374 - content="照经营游商' GROUP" additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:30,590 - apps.chat.task.llm - INFO:1374 - content=' BY `区域名称` ORDER' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:30,721 - apps.chat.task.llm - INFO:1374 - content=' BY `case_count` DESC' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:30,860 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,102 - apps.chat.task.llm - INFO:1374 - content='000",\n' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,256 - apps.chat.task.llm - INFO:1374 - content='  "tables": ["digital' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,420 - apps.chat.task.llm - INFO:1374 - content='_urban_management_cases"],\n ' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,590 - apps.chat.task.llm - INFO:1374 - content=' "chart-type": "table' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,732 - apps.chat.task.llm - INFO:1374 - content='"\n}\n```' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,749 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00'
2025-12-16 15:37:31,750 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--0bad530f-e8f2-45e4-b3e6-f473e97ceb00' usage_metadata={'input_tokens': 4027, 'output_tokens': 113, 'total_tokens': 4140, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}
2025-12-16 15:37:31,770 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `问题类型` = '事件' AND `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "table"
}
```
2025-12-16 15:37:32,144 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:37:32,147 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,148 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,186 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,255 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,275 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,440 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,444 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:32,536 - apps.chat.task.llm - INFO:1374 - content='district_name`, COUNT(*) AS' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:33,491 - apps.chat.task.llm - INFO:1374 - content=' `case_count` FROM `' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:34,597 - apps.chat.task.llm - INFO:1374 - content='hengqiang_auth`.`' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:35,475 - apps.chat.task.llm - INFO:1374 - content='digital_urban_management_cases`' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:35,569 - apps.chat.task.llm - INFO:1374 - content=' WHERE `问题类型` =' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:35,644 - apps.chat.task.llm - INFO:1374 - content=" '事件' AND `小" additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:35,759 - apps.chat.task.llm - INFO:1374 - content="类名称` = '无" additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:35,824 - apps.chat.task.llm - INFO:1374 - content="照经营游商' GROUP" additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:35,956 - apps.chat.task.llm - INFO:1374 - content=' BY `区域名称` ORDER' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:36,027 - apps.chat.task.llm - INFO:1374 - content=' BY `case_count` DESC' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:36,097 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:36,209 - apps.chat.task.llm - INFO:1374 - content='000"\n}\n``' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:36,280 - apps.chat.task.llm - INFO:1374 - content='`\n```' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:36,302 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44'
2025-12-16 15:37:36,304 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--5fc5db0e-a6ea-4a82-88f5-561416a74d44' usage_metadata={'input_tokens': 490, 'output_tokens': 96, 'total_tokens': 586, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:37:36,317 - apps.chat.task.llm - INFO:667 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `问题类型` = '事件' AND `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000"
}
```
```
2025-12-16 15:37:36,317 - apps.chat.task.llm - INFO:1010 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `问题类型` = '事件' AND `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000"
}
```
```
2025-12-16 15:37:36,323 - apps.chat.task.llm - INFO:1019 - sql: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `问题类型` = '事件' AND `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 15:37:36,326 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `问题类型` = '事件' AND `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 15:37:39,226 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:37:39,227 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,228 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,267 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,315 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,381 - apps.chat.task.llm - INFO:1374 - content='": "table' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,472 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,708 - apps.chat.task.llm - INFO:1374 - content='无照经营游商案件' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,824 - apps.chat.task.llm - INFO:1374 - content='统计",\n  "' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,913 - apps.chat.task.llm - INFO:1374 - content='columns": [\n    {"name' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:39,985 - apps.chat.task.llm - INFO:1374 - content='": "区域名称", "' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,095 - apps.chat.task.llm - INFO:1374 - content='value": "district_name"},\n' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,187 - apps.chat.task.llm - INFO:1374 - content='    {"name": "案件' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,276 - apps.chat.task.llm - INFO:1374 - content='数量", "value": "' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,369 - apps.chat.task.llm - INFO:1374 - content='case_count"}\n  ]\n}\n' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,398 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,421 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d'
2025-12-16 15:37:40,423 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--3c1b152c-d804-463e-8991-68e1c6f74e1d' usage_metadata={'input_tokens': 2228, 'output_tokens': 63, 'total_tokens': 2291, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:37:40,442 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "table",
  "title": "无照经营游商案件统计",
  "columns": [
    {"name": "区域名称", "value": "district_name"},
    {"name": "案件数量", "value": "case_count"}
  ]
}
```
2025-12-16 15:37:40,449 - apps.chat.task.llm - INFO:1096 - {'type': 'table', 'title': '无照经营游商案件统计', 'columns': [{'name': '区域名称', 'value': 'district_name'}, {'name': '案件数量', 'value': 'case_count'}]}
2025-12-16 15:41:51,269 - apps.datasource.embedding.table_embedding - INFO:71 - 0.2407691478729248
2025-12-16 15:41:51,269 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.46096791132682585}]
2025-12-16 15:41:51,554 - apps.db.db - INFO:145 - success
2025-12-16 15:41:52,655 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:41:52,656 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:52,657 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:53,042 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:53,429 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:53,447 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:53,565 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:53,620 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:53,724 - apps.chat.task.llm - INFO:1374 - content='district_name`, COUNT' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,114 - apps.chat.task.llm - INFO:1374 - content='(*) AS `case_count`' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,202 - apps.chat.task.llm - INFO:1374 - content=' FROM `hengqiang' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,290 - apps.chat.task.llm - INFO:1374 - content='_auth`.`digital_urban' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,369 - apps.chat.task.llm - INFO:1374 - content='_management_cases` WHERE `小' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,433 - apps.chat.task.llm - INFO:1374 - content="类名称` = '无" additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,534 - apps.chat.task.llm - INFO:1374 - content="照经营游商' GROUP" additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,620 - apps.chat.task.llm - INFO:1374 - content=' BY `区域名称` ORDER' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,699 - apps.chat.task.llm - INFO:1374 - content=' BY `case_count` DESC' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,755 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:54,996 - apps.chat.task.llm - INFO:1374 - content='000",\n' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:55,109 - apps.chat.task.llm - INFO:1374 - content='  "tables": ["digital' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:55,202 - apps.chat.task.llm - INFO:1374 - content='_urban_management_cases"],\n ' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:55,343 - apps.chat.task.llm - INFO:1374 - content=' "chart-type": "table' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:55,397 - apps.chat.task.llm - INFO:1374 - content='"\n}\n```' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:55,416 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4'
2025-12-16 15:41:55,417 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--3d8a165b-0b0e-4b3b-a0ae-4cf8612f30b4' usage_metadata={'input_tokens': 4027, 'output_tokens': 104, 'total_tokens': 4131, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:41:55,437 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "table"
}
```
2025-12-16 15:41:55,955 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:41:55,957 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:55,958 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,005 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,072 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,097 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,216 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,284 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,388 - apps.chat.task.llm - INFO:1374 - content='district_name`, COUNT(*) AS' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,489 - apps.chat.task.llm - INFO:1374 - content=' `case_count` FROM `' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,574 - apps.chat.task.llm - INFO:1374 - content='hengqiang_auth`.`' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,666 - apps.chat.task.llm - INFO:1374 - content='digital_urban_management_cases`' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,732 - apps.chat.task.llm - INFO:1374 - content=' WHERE `小类名称`' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,842 - apps.chat.task.llm - INFO:1374 - content=" = '无照经营游" additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:56,939 - apps.chat.task.llm - INFO:1374 - content="商' GROUP BY `区域" additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:57,684 - apps.chat.task.llm - INFO:1374 - content='名称` ORDER BY `case' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:58,509 - apps.chat.task.llm - INFO:1374 - content='_count` DESC LIMIT 1' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:58,586 - apps.chat.task.llm - INFO:1374 - content='000000' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:58,680 - apps.chat.task.llm - INFO:1374 - content='"\n}\n```' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:58,701 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf'
2025-12-16 15:41:58,702 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--78c29804-d537-493d-8f3a-0951fd10dfcf' usage_metadata={'input_tokens': 481, 'output_tokens': 85, 'total_tokens': 566, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:41:58,713 - apps.chat.task.llm - INFO:667 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000"
}
```
2025-12-16 15:41:58,714 - apps.chat.task.llm - INFO:1010 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000"
}
```
2025-12-16 15:41:58,721 - apps.chat.task.llm - INFO:1019 - sql: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 15:41:58,724 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 15:42:01,614 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:42:01,616 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:01,616 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:01,850 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:01,924 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:02,022 - apps.chat.task.llm - INFO:1374 - content='": "table' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:02,199 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:02,280 - apps.chat.task.llm - INFO:1374 - content='无照经营游商案件' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:02,619 - apps.chat.task.llm - INFO:1374 - content='统计",\n  "' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:02,768 - apps.chat.task.llm - INFO:1374 - content='columns": [\n    {"name' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:02,897 - apps.chat.task.llm - INFO:1374 - content='": "区域名称", "' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,067 - apps.chat.task.llm - INFO:1374 - content='value": "district_name"},\n' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,218 - apps.chat.task.llm - INFO:1374 - content='    {"name": "案件' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,363 - apps.chat.task.llm - INFO:1374 - content='数量", "value": "' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,510 - apps.chat.task.llm - INFO:1374 - content='case_count"}\n  ]\n}\n' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,561 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,585 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011'
2025-12-16 15:42:03,585 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--118657db-5fa3-4cdf-8ac6-a48a7e153011' usage_metadata={'input_tokens': 2219, 'output_tokens': 63, 'total_tokens': 2282, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:42:03,603 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "table",
  "title": "无照经营游商案件统计",
  "columns": [
    {"name": "区域名称", "value": "district_name"},
    {"name": "案件数量", "value": "case_count"}
  ]
}
```
2025-12-16 15:42:03,610 - apps.chat.task.llm - INFO:1096 - {'type': 'table', 'title': '无照经营游商案件统计', 'columns': [{'name': '区域名称', 'value': 'district_name'}, {'name': '案件数量', 'value': 'case_count'}]}
2025-12-16 15:43:13,057 - apps.datasource.embedding.table_embedding - INFO:71 - 0.11904191970825195
2025-12-16 15:43:13,057 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.4755417120508268}]
2025-12-16 15:43:13,344 - apps.db.db - INFO:145 - success
2025-12-16 15:43:14,413 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:43:14,415 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:14,416 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:14,805 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:14,953 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:14,981 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:15,102 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:15,204 - apps.chat.task.llm - INFO:1374 - content=' COUNT(*) AS `case_count' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:15,282 - apps.chat.task.llm - INFO:1374 - content='` FROM `hengq' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:15,402 - apps.chat.task.llm - INFO:1374 - content='iang_auth`.`digital_urban' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:15,502 - apps.chat.task.llm - INFO:1374 - content='_management_cases` WHERE `区域' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:15,566 - apps.chat.task.llm - INFO:1374 - content="名称` = '萧" additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,018 - apps.chat.task.llm - INFO:1374 - content="山区' AND `大" additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,095 - apps.chat.task.llm - INFO:1374 - content="类名称` = '市" additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,215 - apps.chat.task.llm - INFO:1374 - content="容环境' LIMIT 1" additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,325 - apps.chat.task.llm - INFO:1374 - content='000000' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,475 - apps.chat.task.llm - INFO:1374 - content='",\n  "tables": ["' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,500 - apps.chat.task.llm - INFO:1374 - content='digital_urban_management_cases"],\n' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,591 - apps.chat.task.llm - INFO:1374 - content='  "chart-type": "' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,744 - apps.chat.task.llm - INFO:1374 - content='table"\n}\n```' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,768 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--ce03aa57-0342-403c-912a-3ec160d12813'
2025-12-16 15:43:16,768 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--ce03aa57-0342-403c-912a-3ec160d12813' usage_metadata={'input_tokens': 4202, 'output_tokens': 90, 'total_tokens': 4292, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:43:16,791 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `区域名称` = '萧山区' AND `大类名称` = '市容环境' LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "table"
}
```
2025-12-16 15:43:17,202 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:43:17,203 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:17,204 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:17,244 - apps.chat.task.llm - INFO:1374 - content='json\n{"' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:17,306 - apps.chat.task.llm - INFO:1374 - content='success":true' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:17,326 - apps.chat.task.llm - INFO:1374 - content=',"sql":"' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,202 - apps.chat.task.llm - INFO:1374 - content='SELECT COUNT(*) AS `case' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,498 - apps.chat.task.llm - INFO:1374 - content='_count` FROM `heng' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,593 - apps.chat.task.llm - INFO:1374 - content='qiang_auth`.`digital_' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,680 - apps.chat.task.llm - INFO:1374 - content='urban_management_cases` WHERE `' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,746 - apps.chat.task.llm - INFO:1374 - content="区域名称` = '萧" additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,874 - apps.chat.task.llm - INFO:1374 - content="山区' AND `大类" additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:18,917 - apps.chat.task.llm - INFO:1374 - content="名称` = '市容" additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:19,620 - apps.chat.task.llm - INFO:1374 - content="环境' LIMIT 10" additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:19,625 - apps.chat.task.llm - INFO:1374 - content='00000"}\n' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:19,633 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:19,652 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac'
2025-12-16 15:43:19,653 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--361634a8-ac7b-44f2-a9d3-aafecaef8fac' usage_metadata={'input_tokens': 467, 'output_tokens': 65, 'total_tokens': 532, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 15:43:19,664 - apps.chat.task.llm - INFO:667 - ```json
{"success":true,"sql":"SELECT COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `区域名称` = '萧山区' AND `大类名称` = '市容环境' LIMIT 1000000"}
```
2025-12-16 15:43:19,664 - apps.chat.task.llm - INFO:1010 - ```json
{"success":true,"sql":"SELECT COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `区域名称` = '萧山区' AND `大类名称` = '市容环境' LIMIT 1000000"}
```
2025-12-16 15:43:19,671 - apps.chat.task.llm - INFO:1019 - sql: SELECT COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `区域名称` = '萧山区' AND `大类名称` = '市容环境' LIMIT 1000000
2025-12-16 15:43:19,674 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `区域名称` = '萧山区' AND `大类名称` = '市容环境' LIMIT 1000000
2025-12-16 15:43:21,462 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 15:43:21,464 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:21,465 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:21,545 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:21,627 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:21,731 - apps.chat.task.llm - INFO:1374 - content='": "table' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:21,909 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,050 - apps.chat.task.llm - INFO:1374 - content='萧山区市容环境案件' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,227 - apps.chat.task.llm - INFO:1374 - content='数量",\n  "' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,392 - apps.chat.task.llm - INFO:1374 - content='columns": [\n    {"name' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,520 - apps.chat.task.llm - INFO:1374 - content='": "案件数量", "' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,697 - apps.chat.task.llm - INFO:1374 - content='value": "case_count"}\n' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,830 - apps.chat.task.llm - INFO:1374 - content='  ]\n}\n```' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,852 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101'
2025-12-16 15:43:22,853 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--f7d4d5f3-8a0d-4e22-b4d8-3f3e1731e101' usage_metadata={'input_tokens': 2381, 'output_tokens': 48, 'total_tokens': 2429, 'input_token_details': {'cache_read': 2048}, 'output_token_details': {}}
2025-12-16 15:43:22,870 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "table",
  "title": "萧山区市容环境案件数量",
  "columns": [
    {"name": "案件数量", "value": "case_count"}
  ]
}
```
2025-12-16 15:43:22,876 - apps.chat.task.llm - INFO:1096 - {'type': 'table', 'title': '萧山区市容环境案件数量', 'columns': [{'name': '案件数量', 'value': 'case_count'}]}
2025-12-16 18:25:05,924 - apps.datasource.embedding.table_embedding - INFO:71 - 0.2495415210723877
2025-12-16 18:25:05,924 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.6106243321772954}]
2025-12-16 18:25:06,219 - apps.db.db - INFO:145 - success
2025-12-16 18:25:07,970 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 18:25:07,971 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:07,972 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,012 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,075 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,100 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,210 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,276 - apps.chat.task.llm - INFO:1374 - content=' `上报时间小时` AS' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,378 - apps.chat.task.llm - INFO:1374 - content=' `report_hour`, COUNT' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,467 - apps.chat.task.llm - INFO:1374 - content='(*) AS `case_count`' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,676 - apps.chat.task.llm - INFO:1374 - content=' FROM `hengqiang' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,759 - apps.chat.task.llm - INFO:1374 - content='_auth`.`digital_urban_management' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,845 - apps.chat.task.llm - INFO:1374 - content='_cases` WHERE `小类' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:08,915 - apps.chat.task.llm - INFO:1374 - content="名称` = '无照" additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:09,079 - apps.chat.task.llm - INFO:1374 - content="经营游商' GROUP BY" additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:09,179 - apps.chat.task.llm - INFO:1374 - content=' `上报时间小时` ORDER' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:09,269 - apps.chat.task.llm - INFO:1374 - content=' BY `report_hour` ASC' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:09,990 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,099 - apps.chat.task.llm - INFO:1374 - content='000",\n  "' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,186 - apps.chat.task.llm - INFO:1374 - content='tables": ["digital_urban' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,278 - apps.chat.task.llm - INFO:1374 - content='_management_cases"],\n  "chart' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,352 - apps.chat.task.llm - INFO:1374 - content='-type": "line' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,440 - apps.chat.task.llm - INFO:1374 - content='"\n}\n```' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,458 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--a5a3711b-7444-497a-8852-a3650755aa85'
2025-12-16 18:25:10,459 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--a5a3711b-7444-497a-8852-a3650755aa85' usage_metadata={'input_tokens': 4205, 'output_tokens': 106, 'total_tokens': 4311, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 18:25:10,482 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `上报时间小时` AS `report_hour`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `上报时间小时` ORDER BY `report_hour` ASC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "line"
}
```
2025-12-16 18:25:10,488 - apps.chat.task.llm - INFO:1019 - sql: SELECT `上报时间小时` AS `report_hour`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `上报时间小时` ORDER BY `report_hour` ASC LIMIT 1000000
2025-12-16 18:25:10,490 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `上报时间小时` AS `report_hour`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `上报时间小时` ORDER BY `report_hour` ASC LIMIT 1000000
2025-12-16 18:25:13,531 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 18:25:13,533 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:13,534 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:13,569 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:13,609 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:13,669 - apps.chat.task.llm - INFO:1374 - content='": "line' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:14,021 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:14,716 - apps.chat.task.llm - INFO:1374 - content='无照经营游商案件' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,172 - apps.chat.task.llm - INFO:1374 - content='上报时间分布",\n  "' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,265 - apps.chat.task.llm - INFO:1374 - content='axis": {\n    "x' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,339 - apps.chat.task.llm - INFO:1374 - content='": {\n      "name":' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,399 - apps.chat.task.llm - INFO:1374 - content=' "上报时间（' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,497 - apps.chat.task.llm - INFO:1374 - content='小时）",\n      "value' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,584 - apps.chat.task.llm - INFO:1374 - content='": "report_hour"\n   ' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,730 - apps.chat.task.llm - INFO:1374 - content=' },\n    "y": {\n' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,744 - apps.chat.task.llm - INFO:1374 - content='      "name": "案件' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,879 - apps.chat.task.llm - INFO:1374 - content='数量",\n      "value":' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:15,955 - apps.chat.task.llm - INFO:1374 - content=' "case_count"\n    }\n' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:16,020 - apps.chat.task.llm - INFO:1374 - content='  }\n}\n```' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:16,040 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--2162394d-e4b3-43c3-887e-939481fd089c'
2025-12-16 18:25:16,041 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--2162394d-e4b3-43c3-887e-939481fd089c' usage_metadata={'input_tokens': 2416, 'output_tokens': 84, 'total_tokens': 2500, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 18:25:16,059 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "line",
  "title": "无照经营游商案件上报时间分布",
  "axis": {
    "x": {
      "name": "上报时间（小时）",
      "value": "report_hour"
    },
    "y": {
      "name": "案件数量",
      "value": "case_count"
    }
  }
}
```
2025-12-16 18:25:16,066 - apps.chat.task.llm - INFO:1096 - {'type': 'line', 'title': '无照经营游商案件上报时间分布', 'axis': {'x': {'name': '上报时间（小时）', 'value': 'report_hour'}, 'y': {'name': '案件数量', 'value': 'case_count'}}}
2025-12-16 18:25:16,853 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 18:25:16,856 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:16,857 - apps.chat.task.llm - INFO:1374 - content='["' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:16,995 - apps.chat.task.llm - INFO:1374 - content='萧' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:17,131 - apps.chat.task.llm - INFO:1374 - content='山区市容' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:17,140 - apps.chat.task.llm - INFO:1374 - content='环境大类' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:17,279 - apps.chat.task.llm - INFO:1374 - content='的所有案件的数量","' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:17,487 - apps.chat.task.llm - INFO:1374 - content='哪个区发生无照' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:17,646 - apps.chat.task.llm - INFO:1374 - content='经营游商案件最多，' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:17,754 - apps.chat.task.llm - INFO:1374 - content='发生了多少起","使用' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,068 - apps.chat.task.llm - INFO:1374 - content='柱状图展示无照' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,172 - apps.chat.task.llm - INFO:1374 - content='经营游商案件在' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,323 - apps.chat.task.llm - INFO:1374 - content='不同时间段的上报数量' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,435 - apps.chat.task.llm - INFO:1374 - content='","使用折线图' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,585 - apps.chat.task.llm - INFO:1374 - content='展示无照经营游商' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,693 - apps.chat.task.llm - INFO:1374 - content='案件的上报时间趋势"]' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,774 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3'
2025-12-16 18:25:18,776 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--ba1de25a-5ec0-463c-bb4b-fa3496715df3' usage_metadata={'input_tokens': 1285, 'output_tokens': 61, 'total_tokens': 1346, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 20:46:18,803 - apps.datasource.embedding.table_embedding - INFO:71 - 0.24548745155334473
2025-12-16 20:46:18,803 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.46096791132682585}]
2025-12-16 20:46:19,112 - apps.db.db - INFO:145 - success
2025-12-16 20:46:20,431 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 20:46:20,433 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:20,434 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:20,647 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:20,728 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:20,781 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:20,929 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:21,037 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:21,187 - apps.chat.task.llm - INFO:1374 - content='district_name`, COUNT(*) AS' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:21,336 - apps.chat.task.llm - INFO:1374 - content=' `case_count` FROM `' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:21,432 - apps.chat.task.llm - INFO:1374 - content='hengqiang_auth`.`' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:21,553 - apps.chat.task.llm - INFO:1374 - content='digital_urban_management_cases`' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:21,670 - apps.chat.task.llm - INFO:1374 - content=' WHERE `小类名称`' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,047 - apps.chat.task.llm - INFO:1374 - content=" = '无照经营游" additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,171 - apps.chat.task.llm - INFO:1374 - content="商' GROUP BY `区域" additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,303 - apps.chat.task.llm - INFO:1374 - content='名称` ORDER BY `case' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,420 - apps.chat.task.llm - INFO:1374 - content='_count` DESC LIMIT 1' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,538 - apps.chat.task.llm - INFO:1374 - content='000000' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,679 - apps.chat.task.llm - INFO:1374 - content='",\n  "tables": ["' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,800 - apps.chat.task.llm - INFO:1374 - content='digital_urban_management_cases"],\n' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:22,922 - apps.chat.task.llm - INFO:1374 - content='  "chart-type": "' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:23,028 - apps.chat.task.llm - INFO:1374 - content='table"\n}\n```' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:23,047 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--836c2650-35a4-4217-86f9-4922b55a941d'
2025-12-16 20:46:23,049 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--836c2650-35a4-4217-86f9-4922b55a941d' usage_metadata={'input_tokens': 4367, 'output_tokens': 104, 'total_tokens': 4471, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 20:46:23,074 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "table"
}
```
2025-12-16 20:46:23,467 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 20:46:23,470 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:23,470 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:23,656 - apps.chat.task.llm - INFO:1374 - content='json\n{"' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:23,732 - apps.chat.task.llm - INFO:1374 - content='success":true' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:23,772 - apps.chat.task.llm - INFO:1374 - content=',"sql":"' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:23,906 - apps.chat.task.llm - INFO:1374 - content='SELECT `区域名称` AS' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,081 - apps.chat.task.llm - INFO:1374 - content=' `district_name`, COUNT(*)' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,198 - apps.chat.task.llm - INFO:1374 - content=' AS `case_count` FROM' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,310 - apps.chat.task.llm - INFO:1374 - content=' `hengqiang_auth' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,422 - apps.chat.task.llm - INFO:1374 - content='`.`digital_urban_management_cases' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,615 - apps.chat.task.llm - INFO:1374 - content='` WHERE `小类名称' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,656 - apps.chat.task.llm - INFO:1374 - content="` = '无照经营" additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,744 - apps.chat.task.llm - INFO:1374 - content="游商' GROUP BY `" additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,883 - apps.chat.task.llm - INFO:1374 - content='区域名称` ORDER BY `' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:24,999 - apps.chat.task.llm - INFO:1374 - content='case_count` DESC LIMIT ' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:25,089 - apps.chat.task.llm - INFO:1374 - content='100000' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:25,202 - apps.chat.task.llm - INFO:1374 - content='0"}\n```' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:25,221 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3'
2025-12-16 20:46:25,222 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--06e1ae4f-6e5f-4630-8d77-53a2afc558e3' usage_metadata={'input_tokens': 481, 'output_tokens': 79, 'total_tokens': 560, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 20:46:25,237 - apps.chat.task.llm - INFO:667 - ```json
{"success":true,"sql":"SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000"}
```
2025-12-16 20:46:25,237 - apps.chat.task.llm - INFO:1010 - ```json
{"success":true,"sql":"SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000"}
```
2025-12-16 20:46:25,247 - apps.chat.task.llm - INFO:1019 - sql: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 20:46:25,250 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `hengqiang_auth`.`digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-16 20:46:28,198 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-16 20:46:28,200 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,202 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,351 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,408 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,482 - apps.chat.task.llm - INFO:1374 - content='": "table' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,674 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,766 - apps.chat.task.llm - INFO:1374 - content='无照经营游商案件' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:28,904 - apps.chat.task.llm - INFO:1374 - content='统计",\n  "columns":' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:29,011 - apps.chat.task.llm - INFO:1374 - content=' [\n    {"name": "' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,452 - apps.chat.task.llm - INFO:1374 - content='区域名称", "value":' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,577 - apps.chat.task.llm - INFO:1374 - content=' "district_name"},\n    {"' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,677 - apps.chat.task.llm - INFO:1374 - content='name": "案件数量",' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,823 - apps.chat.task.llm - INFO:1374 - content=' "value": "case_count' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,932 - apps.chat.task.llm - INFO:1374 - content='"}\n  ]\n}\n```' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,954 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4'
2025-12-16 20:46:30,955 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--8e518303-dd91-4ae3-bff1-15ad216a03f4' usage_metadata={'input_tokens': 2546, 'output_tokens': 63, 'total_tokens': 2609, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-16 20:46:30,974 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "table",
  "title": "无照经营游商案件统计",
  "columns": [
    {"name": "区域名称", "value": "district_name"},
    {"name": "案件数量", "value": "case_count"}
  ]
}
```
2025-12-16 20:46:30,981 - apps.chat.task.llm - INFO:1096 - {'type': 'table', 'title': '无照经营游商案件统计', 'columns': [{'name': '区域名称', 'value': 'district_name'}, {'name': '案件数量', 'value': 'case_count'}]}
2025-12-17 09:41:21,189 - apps.datasource.embedding.table_embedding - INFO:71 - 0.2413041591644287
2025-12-17 09:41:21,190 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.49931186591168303}]
2025-12-17 09:41:21,515 - apps.db.db - INFO:145 - success
2025-12-17 09:41:23,198 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-17 09:41:23,200 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,201 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,280 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,380 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,445 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,629 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,750 - apps.chat.task.llm - INFO:1374 - content=' `处置部门所属区域' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:23,924 - apps.chat.task.llm - INFO:1374 - content='名称` AS `处置' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:24,128 - apps.chat.task.llm - INFO:1374 - content='区域`, COUNT(`id' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:24,363 - apps.chat.task.llm - INFO:1374 - content='`) AS `案件数量' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:24,484 - apps.chat.task.llm - INFO:1374 - content='` FROM `hengq' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:24,658 - apps.chat.task.llm - INFO:1374 - content='iang_auth`.`digital_urban' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:24,923 - apps.chat.task.llm - INFO:1374 - content='_management_cases` `' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:25,059 - apps.chat.task.llm - INFO:1374 - content='c` WHERE `' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:25,326 - apps.chat.task.llm - INFO:1374 - content='c`.`街道名称` =' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:25,471 - apps.chat.task.llm - INFO:1374 - content=" '小营街道' GROUP" additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:25,672 - apps.chat.task.llm - INFO:1374 - content=' BY `c`.`处置部门' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:25,799 - apps.chat.task.llm - INFO:1374 - content='所属区域名称` ORDER BY' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:25,955 - apps.chat.task.llm - INFO:1374 - content=' `案件数量` DESC LIMIT' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,124 - apps.chat.task.llm - INFO:1374 - content=' 10000' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,298 - apps.chat.task.llm - INFO:1374 - content='00",\n  "tables' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,502 - apps.chat.task.llm - INFO:1374 - content='": ["digital_urban_management' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,656 - apps.chat.task.llm - INFO:1374 - content='_cases"],\n  "chart-type' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,807 - apps.chat.task.llm - INFO:1374 - content='": "column"\n}\n```' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,881 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--f659359c-7051-4c35-b3d2-6abd6e404197'
2025-12-17 09:41:26,882 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--f659359c-7051-4c35-b3d2-6abd6e404197' usage_metadata={'input_tokens': 4023, 'output_tokens': 116, 'total_tokens': 4139, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-17 09:41:26,909 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `处置部门所属区域名称` AS `处置区域`, COUNT(`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`街道名称` = '小营街道' GROUP BY `c`.`处置部门所属区域名称` ORDER BY `案件数量` DESC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "column"
}
```
2025-12-17 09:41:27,270 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-17 09:41:27,271 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,272 - apps.chat.task.llm - INFO:1374 - content='{"' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,369 - apps.chat.task.llm - INFO:1374 - content='success":true' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,428 - apps.chat.task.llm - INFO:1374 - content=',"sql":"' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,439 - apps.chat.task.llm - INFO:1374 - content='SELECT `c' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,525 - apps.chat.task.llm - INFO:1374 - content='`.`处置部门所属区域名称' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,575 - apps.chat.task.llm - INFO:1374 - content='` AS `处置区域`,' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,664 - apps.chat.task.llm - INFO:1374 - content=' COUNT(`c`.`id`)' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,735 - apps.chat.task.llm - INFO:1374 - content=' AS `案件数量` FROM' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:27,799 - apps.chat.task.llm - INFO:1374 - content=' `hengqiang_auth' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,465 - apps.chat.task.llm - INFO:1374 - content='`.`digital_urban_management_cases' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,635 - apps.chat.task.llm - INFO:1374 - content='` `c` WHERE `' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,687 - apps.chat.task.llm - INFO:1374 - content='c`.`街道名称` =' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,737 - apps.chat.task.llm - INFO:1374 - content=" '小营街道' GROUP" additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,828 - apps.chat.task.llm - INFO:1374 - content=' BY `c`.`处置部门' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,908 - apps.chat.task.llm - INFO:1374 - content='所属区域名称` ORDER BY' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:28,955 - apps.chat.task.llm - INFO:1374 - content=' `案件数量` DESC' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:29,051 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:29,104 - apps.chat.task.llm - INFO:1374 - content='000"}' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:29,132 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125'
2025-12-17 09:41:29,133 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--53ecf033-6ae9-48fd-abb9-eab235b32125' usage_metadata={'input_tokens': 493, 'output_tokens': 91, 'total_tokens': 584, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-17 09:41:29,142 - apps.chat.task.llm - INFO:667 - {"success":true,"sql":"SELECT `c`.`处置部门所属区域名称` AS `处置区域`, COUNT(`c`.`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`街道名称` = '小营街道' GROUP BY `c`.`处置部门所属区域名称` ORDER BY `案件数量` DESC LIMIT 1000000"}
2025-12-17 09:41:29,142 - apps.chat.task.llm - INFO:1010 - {"success":true,"sql":"SELECT `c`.`处置部门所属区域名称` AS `处置区域`, COUNT(`c`.`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`街道名称` = '小营街道' GROUP BY `c`.`处置部门所属区域名称` ORDER BY `案件数量` DESC LIMIT 1000000"}
2025-12-17 09:41:29,149 - apps.chat.task.llm - INFO:1019 - sql: SELECT `c`.`处置部门所属区域名称` AS `处置区域`, COUNT(`c`.`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`街道名称` = '小营街道' GROUP BY `c`.`处置部门所属区域名称` ORDER BY `案件数量` DESC LIMIT 1000000
2025-12-17 09:41:29,154 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `c`.`处置部门所属区域名称` AS `处置区域`, COUNT(`c`.`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`街道名称` = '小营街道' GROUP BY `c`.`处置部门所属区域名称` ORDER BY `案件数量` DESC LIMIT 1000000
2025-12-17 09:41:30,175 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-17 09:41:30,176 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,177 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,179 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,183 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,277 - apps.chat.task.llm - INFO:1374 - content='": "column' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,306 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,353 - apps.chat.task.llm - INFO:1374 - content='小营街道案件分布",\n' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,455 - apps.chat.task.llm - INFO:1374 - content='  "axis": {\n   ' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,524 - apps.chat.task.llm - INFO:1374 - content=' "x": {\n      "' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,600 - apps.chat.task.llm - INFO:1374 - content='name": "处置区域",\n' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,752 - apps.chat.task.llm - INFO:1374 - content='      "value": "处置' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,754 - apps.chat.task.llm - INFO:1374 - content='区域"\n    },\n' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,826 - apps.chat.task.llm - INFO:1374 - content='    "y": {\n     ' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,885 - apps.chat.task.llm - INFO:1374 - content=' "name": "案件数量' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:30,983 - apps.chat.task.llm - INFO:1374 - content='",\n      "value": "' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:31,035 - apps.chat.task.llm - INFO:1374 - content='案件数量"\n    }\n ' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:31,133 - apps.chat.task.llm - INFO:1374 - content=' }\n}\n```' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:31,150 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--30abd615-b244-46a8-b98b-4cc453823c38'
2025-12-17 09:41:31,150 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--30abd615-b244-46a8-b98b-4cc453823c38' usage_metadata={'input_tokens': 2231, 'output_tokens': 77, 'total_tokens': 2308, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-17 09:41:31,170 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "column",
  "title": "小营街道案件分布",
  "axis": {
    "x": {
      "name": "处置区域",
      "value": "处置区域"
    },
    "y": {
      "name": "案件数量",
      "value": "案件数量"
    }
  }
}
```
2025-12-17 09:41:31,177 - apps.chat.task.llm - INFO:1096 - {'type': 'column', 'title': '小营街道案件分布', 'axis': {'x': {'name': '处置区域', 'value': '处置区域'}, 'y': {'name': '案件数量', 'value': '案件数量'}}}
2025-12-17 09:41:46,422 - apps.datasource.embedding.table_embedding - INFO:71 - 0.12316775321960449
2025-12-17 09:41:46,422 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(id:bigint),\n(imported_at:timestamp),\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d)\n]\n", "cosine_similarity": 0.49572169800940424}]
2025-12-17 09:41:46,719 - apps.db.db - INFO:145 - success
2025-12-17 09:41:47,966 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-17 09:41:47,967 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:47,967 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,182 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,260 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,307 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,448 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,685 - apps.chat.task.llm - INFO:1374 - content=' COUNT(`id`) AS `' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,783 - apps.chat.task.llm - INFO:1374 - content='案件数量` FROM `h' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:48,935 - apps.chat.task.llm - INFO:1374 - content='engqiang_auth`.`digital' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,052 - apps.chat.task.llm - INFO:1374 - content='_urban_management_cases` `' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,143 - apps.chat.task.llm - INFO:1374 - content='c` WHERE `c`.`' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,272 - apps.chat.task.llm - INFO:1374 - content='区域名称` =' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,401 - apps.chat.task.llm - INFO:1374 - content=" '余杭区' AND" additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,606 - apps.chat.task.llm - INFO:1374 - content=' `c`.`结案' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,753 - apps.chat.task.llm - INFO:1374 - content="时间` LIKE '20" additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,913 - apps.chat.task.llm - INFO:1374 - content='25-06-%' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:49,992 - apps.chat.task.llm - INFO:1374 - content="' AND `c`.`结" additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:50,477 - apps.chat.task.llm - INFO:1374 - content='案类型名称` !=' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:50,575 - apps.chat.task.llm - INFO:1374 - content=" '正常结案' LIMIT" additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:50,708 - apps.chat.task.llm - INFO:1374 - content=' 10000' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:50,802 - apps.chat.task.llm - INFO:1374 - content='00",\n  "tables' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:50,934 - apps.chat.task.llm - INFO:1374 - content='": ["digital_urban_management' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:51,055 - apps.chat.task.llm - INFO:1374 - content='_cases"],\n  "chart-type' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:51,165 - apps.chat.task.llm - INFO:1374 - content='": "table"\n}\n```' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:51,223 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573'
2025-12-17 09:41:51,224 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--0fe5713c-08c2-4c5a-a870-819a4872c573' usage_metadata={'input_tokens': 4219, 'output_tokens': 120, 'total_tokens': 4339, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-17 09:41:51,250 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT COUNT(`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`区域名称` = '余杭区' AND `c`.`结案时间` LIKE '2025-06-%' AND `c`.`结案类型名称` != '正常结案' LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "table"
}
```
2025-12-17 09:41:51,666 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-17 09:41:51,667 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:51,668 - apps.chat.task.llm - INFO:1374 - content='{"' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:51,720 - apps.chat.task.llm - INFO:1374 - content='success":true' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:51,793 - apps.chat.task.llm - INFO:1374 - content=',"sql":"' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:51,831 - apps.chat.task.llm - INFO:1374 - content='SELECT COUNT(`' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:51,965 - apps.chat.task.llm - INFO:1374 - content='id`) AS `案件数量' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:52,052 - apps.chat.task.llm - INFO:1374 - content='` FROM `hengq' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:52,185 - apps.chat.task.llm - INFO:1374 - content='iang_auth`.`digital_urban' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:52,291 - apps.chat.task.llm - INFO:1374 - content='_management_cases` `c`' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:52,396 - apps.chat.task.llm - INFO:1374 - content=' WHERE `c`.`区域名称' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:53,401 - apps.chat.task.llm - INFO:1374 - content="` = '余杭区" additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:53,543 - apps.chat.task.llm - INFO:1374 - content="' AND `c`.`结" additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:53,647 - apps.chat.task.llm - INFO:1374 - content="案时间` LIKE '2" additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:53,792 - apps.chat.task.llm - INFO:1374 - content='025-06' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:53,899 - apps.chat.task.llm - INFO:1374 - content="-%' AND `c`.`" additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:54,046 - apps.chat.task.llm - INFO:1374 - content='结案类型名称` !=' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:54,148 - apps.chat.task.llm - INFO:1374 - content=" '正常结案' LIMIT" additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:54,391 - apps.chat.task.llm - INFO:1374 - content=' 10000' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:54,499 - apps.chat.task.llm - INFO:1374 - content='00"}' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:54,521 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--4181f25e-230c-4667-be37-b59f377253ab'
2025-12-17 09:41:54,521 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--4181f25e-230c-4667-be37-b59f377253ab' usage_metadata={'input_tokens': 497, 'output_tokens': 91, 'total_tokens': 588, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-17 09:41:54,532 - apps.chat.task.llm - INFO:667 - {"success":true,"sql":"SELECT COUNT(`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`区域名称` = '余杭区' AND `c`.`结案时间` LIKE '2025-06-%' AND `c`.`结案类型名称` != '正常结案' LIMIT 1000000"}
2025-12-17 09:41:54,533 - apps.chat.task.llm - INFO:1010 - {"success":true,"sql":"SELECT COUNT(`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`区域名称` = '余杭区' AND `c`.`结案时间` LIKE '2025-06-%' AND `c`.`结案类型名称` != '正常结案' LIMIT 1000000"}
2025-12-17 09:41:54,541 - apps.chat.task.llm - INFO:1019 - sql: SELECT COUNT(`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`区域名称` = '余杭区' AND `c`.`结案时间` LIKE '2025-06-%' AND `c`.`结案类型名称` != '正常结案' LIMIT 1000000
2025-12-17 09:41:54,545 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT COUNT(`id`) AS `案件数量` FROM `hengqiang_auth`.`digital_urban_management_cases` `c` WHERE `c`.`区域名称` = '余杭区' AND `c`.`结案时间` LIKE '2025-06-%' AND `c`.`结案类型名称` != '正常结案' LIMIT 1000000
2025-12-17 09:41:56,910 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-17 09:41:56,912 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:56,913 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,134 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,199 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,278 - apps.chat.task.llm - INFO:1374 - content='": "table' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,400 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,586 - apps.chat.task.llm - INFO:1374 - content='2025年6' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,706 - apps.chat.task.llm - INFO:1374 - content='月余杭区非正常' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:57,843 - apps.chat.task.llm - INFO:1374 - content='结案案件数量' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,063 - apps.chat.task.llm - INFO:1374 - content='",\n  "columns": [\n' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,178 - apps.chat.task.llm - INFO:1374 - content='    {\n      "name":' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,288 - apps.chat.task.llm - INFO:1374 - content=' "案件数量",\n      "' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,570 - apps.chat.task.llm - INFO:1374 - content='value": "案件数量"\n' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,691 - apps.chat.task.llm - INFO:1374 - content='    }\n  ]\n}\n```' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,748 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821'
2025-12-17 09:41:58,749 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--e12cbdfd-aeb7-4702-b072-0ac2928ba821' usage_metadata={'input_tokens': 2446, 'output_tokens': 62, 'total_tokens': 2508, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-17 09:41:58,765 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "table",
  "title": "2025年6月余杭区非正常结案案件数量",
  "columns": [
    {
      "name": "案件数量",
      "value": "案件数量"
    }
  ]
}
```
2025-12-17 09:41:58,772 - apps.chat.task.llm - INFO:1096 - {'type': 'table', 'title': '2025年6月余杭区非正常结案案件数量', 'columns': [{'name': '案件数量', 'value': '案件数量'}]}
2025-12-25 09:31:52,172 - apps.db.db - INFO:145 - success
2025-12-25 09:31:53,088 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-25 09:31:53,091 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,093 - apps.chat.task.llm - INFO:1374 - content='["' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,257 - apps.chat.task.llm - INFO:1374 - content='哪个区发生' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,325 - apps.chat.task.llm - INFO:1374 - content='无照经营' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,396 - apps.chat.task.llm - INFO:1374 - content='游商案件' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,555 - apps.chat.task.llm - INFO:1374 - content='最多，发生了多少起",' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,667 - apps.chat.task.llm - INFO:1374 - content=' "使用柱状图' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,814 - apps.chat.task.llm - INFO:1374 - content='展示各区域的案件数量' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:53,927 - apps.chat.task.llm - INFO:1374 - content='", "查询所有2' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,077 - apps.chat.task.llm - INFO:1374 - content='025年6月' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,185 - apps.chat.task.llm - INFO:1374 - content='余杭区非' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,310 - apps.chat.task.llm - INFO:1374 - content='“正常结案”的案件' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,460 - apps.chat.task.llm - INFO:1374 - content='详情", "小' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,561 - apps.chat.task.llm - INFO:1374 - content='营街道负责处置的案件' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,953 - apps.chat.task.llm - INFO:1374 - content='分布在哪些区域？' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:54,997 - apps.chat.task.llm - INFO:1374 - content='"]' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:55,035 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1'
2025-12-25 09:31:55,037 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--ed5e7b3b-63ce-4adb-b9a2-24c603efe1f1' usage_metadata={'input_tokens': 1319, 'output_tokens': 63, 'total_tokens': 1382, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-25 09:32:39,019 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 09:32:39,020 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:32:39,490 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.46512365341186523 seconds
2025-12-25 09:32:39,492 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.46865344047546387 seconds
2025-12-25 09:32:39,691 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 09:32:39,695 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:32:39,985 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.28984713554382324 seconds
2025-12-25 09:32:39,991 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.2987794876098633 seconds
2025-12-25 09:32:41,114 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 09:32:41,117 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:32:41,401 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.2836334705352783 seconds
2025-12-25 09:32:41,414 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.29491353034973145 seconds
2025-12-25 09:32:41,630 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 09:32:41,632 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:32:41,915 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.28270673751831055 seconds
2025-12-25 09:32:41,931 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.2971010208129883 seconds
2025-12-25 09:32:45,128 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 09:32:45,132 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:32:45,423 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.29186153411865234 seconds
2025-12-25 09:32:45,442 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.30988073348999023 seconds
2025-12-25 09:32:45,620 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 09:32:45,621 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:32:45,914 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.29150891304016113 seconds
2025-12-25 09:32:45,919 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.29492664337158203 seconds
2025-12-25 09:36:03,392 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 09:36:03,766 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.3702359199523926 seconds
2025-12-25 13:36:49,368 - apps.db.db - INFO:145 - success
2025-12-25 13:37:01,288 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 13:37:01,290 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 13:37:01,745 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.4559173583984375 seconds
2025-12-25 13:37:01,746 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.45546483993530273 seconds
2025-12-25 13:37:02,111 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 13:37:02,113 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 13:37:02,398 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.2844109535217285 seconds
2025-12-25 13:37:02,407 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.2920095920562744 seconds
2025-12-25 13:37:46,662 - apps.db.db - INFO:145 - success
2025-12-25 13:37:47,153 - apps.datasource.crud.table - INFO:64 - start table embedding
2025-12-25 13:37:47,158 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 13:37:47,556 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.39668703079223633 seconds
2025-12-25 13:37:48,023 - apps.datasource.crud.table - INFO:102 - table embedding finished in: 0.8690214157104492 seconds
2025-12-25 13:42:43,455 - apps.datasource.embedding.table_embedding - INFO:71 - 0.1666548252105713
2025-12-25 13:42:43,455 - apps.datasource.embedding.table_embedding - INFO:72 - [{"id": 1, "schema_table": "# Table: digital_urban_management_cases\n[\n(\u4e00\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4e0a\u62a5\u65f6\u95f4\u5c0f\u65f6:bigint, \u6848\u4ef6\u5728\u5f53\u5929\u7684\u54ea\u4e2a\u65f6\u95f4\u6bb5\u4e0a\u62a5\u7684\uff0c\u4e0d\u662f\u5177\u4f53\u7684\u65e5\u671f\uff0c\u53ea\u662f\u5f53\u5929\u7684\u67d0\u4e2a\u5c0f\u65f6\u6bb5\uff0c\u683c\u5f0f\u6bd4\u5982\u201c05\u201d\u201c11\u201d),\n(\u4e0a\u62a5\u7f51\u683c\u5458:text),\n(\u4e0a\u62a5\u8d23\u4efb\u7f51\u683c\u540d\u79f0:text),\n(\u4e0d\u53d7\u7406\u610f\u89c1:text),\n(\u4e13\u4e1a\u90e8\u95e8\u56de\u9000\u6b21\u6570:bigint),\n(\u4e8c\u7ea7\u5904\u7f6e\u90e8\u95e8\u540d\u79f0:text),\n(\u4efb\u52a1\u53f7:bigint, \u4e8b\u4ef6\u7684\u4efb\u52a1\u53f7\uff0c\u683c\u5f0f\u5f62\u5982\uff1a202506010002),\n(\u4f5c\u5e9f\u4eba\u59d3\u540d:text),\n(\u4f5c\u5e9f\u610f\u89c1:text),\n(\u4f5c\u5e9f\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-24 09:10:00\u201d),\n(\u4fee\u6b63\u610f\u89c1:double),\n(\u521b\u5efa\u65f6\u95f4:text, \u4e8b\u4ef6\u7684\u53d1\u751f\u65f6\u95f4\uff0c\u683c\u5f0f\u5f62\u5982\uff1a2025-06-01 05:59:37),\n(\u533a\u57df\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u533a),\n(\u53d1\u6838\u67e5\u65f6\u95f4:text),\n(\u53d1\u9001\u6838\u67e5\u6b21\u6570:bigint),\n(\u53d7\u7406\u5458\u540d\u79f0:text),\n(\u5730\u5740:text, \u4e8b\u4ef6\u53d1\u751f\u7684\u5177\u4f53\u5730\u5740),\n(\u5904\u7f6e\u610f\u89c1:text),\n(\u5904\u7f6e\u65f6\u9650:text),\n(\u5904\u7f6e\u90e8\u95e8:text),\n(\u5904\u7f6e\u90e8\u95e8\u6240\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u5927\u7c7b\u540d\u79f0:text, \u4e8b\u4ef6\u7684\u5927\u7c7b\uff0c\u6bd4\u5982\u201c\u5e02\u5bb9\u73af\u5883\u201d\u201c\u7a81\u53d1\u4e8b\u4ef6\u201d\u201c\u8857\u9762\u79e9\u5e8f\u201d\u7b49),\n(\u5c0f\u7c7b\u540d\u79f0:text, \u5177\u4f53\u5230\u67d0\u4e2a\u5c0f\u7c7b\uff0c\u6bd4\u5982\u201c\u9053\u8def\u4e0d\u6d01\u201d),\n(\u5ef6\u671f\u6570:bigint),\n(\u5ef6\u671f\u6b21\u6570:bigint),\n(\u5f53\u524d\u9636\u6bb5\u540d\u79f0:text),\n(\u6346\u7ed1\u5904\u7f6e\u65f6\u9650:text),\n(\u6388\u6743\u7b54\u590d\u610f\u89c1:text),\n(\u662f\u5426\u6709\u9644\u4ef6:bigint),\n(\u6700\u540e\u4e00\u4e2a\u5904\u7f6e\u90e8\u95e8\u7ecf\u529e\u610f\u89c1:text),\n(\u6700\u540e\u4e00\u6b21\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u53cd\u9988\u65f6\u95f4:text),\n(\u6838\u67e5\u6570:bigint),\n(\u6838\u67e5\u72b6\u6001:text),\n(\u6848\u4ef6\u7c7b\u578b:text, \u6848\u4ef6\u7c7b\u578b\uff0c\u8be5\u6570\u636e\u5e93\u4e2d\u7684\u6848\u4ef6\u7c7b\u578b\u5747\u4e3a\u201c\u57ce\u5e02\u7ba1\u7406\u7c7b\u201d),\n(\u6d3e\u9063\u5458\u59d3\u540d:text),\n(\u6d3e\u9063\u6b21\u6570:bigint),\n(\u793e\u533a\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u793e\u533a),\n(\u7acb\u6848\u5efa\u8bae:double),\n(\u7acb\u6848\u6761\u4ef6:text, \u5177\u4f53\u5230\u4e8b\u4ef6\uff0c\u6bd4\u5982\u201c\u7eff\u5730\u4e2d\u4e22\u5f03\u5783\u573e\u3001\u5e9f\u5f03\u7269\u201c),\n(\u7d27\u6025\u6807\u8bc6:bigint),\n(\u7ecf\u529e\u5904\u7f6e\u90e8\u95e8\u4eba\u5458:text),\n(\u7ed1\u5b9a\u622a\u6b62\u65f6\u95f4:text),\n(\u7ed1\u5b9a\u8d85\u65f6\u500d\u6570:bigint),\n(\u7ed1\u5b9a\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u7ed3\u6848\u4eba\u59d3\u540d:text),\n(\u7ed3\u6848\u610f\u89c1:text),\n(\u7ed3\u6848\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-20 09:45:30\u201d),\n(\u7ed3\u6848\u6761\u4ef6\u540d\u79f0:text),\n(\u7ed3\u6848\u7c7b\u578b\u540d\u79f0:text),\n(\u7f13\u529e\u6b21\u6570:bigint),\n(\u7f51\u683c\u540d\u79f0:text),\n(\u8857\u9053\u540d\u79f0:text, \u4e8b\u4ef6\u53d1\u751f\u5728\u54ea\u4e2a\u8857\u9053),\n(\u8d23\u5c5e\u533a\u57df\u540d\u79f0:text),\n(\u8d85\u65f6\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u500d\u6570:bigint),\n(\u8d85\u65f6\u5904\u7f6e\u6570:bigint),\n(\u8fd4\u5de5\u6570:bigint),\n(\u8fd4\u5de5\u6b21\u6570:bigint),\n(\u9053\u8def\u540d\u79f0:text),\n(\u9053\u8def\u7c7b\u578b\u540d\u79f0:text, \u8fd9\u4e2a\u5b57\u6bb5\u53ef\u9009\u7684\u9053\u8def\u7c7b\u578b\u5305\u62ec\u4ee5\u4e0b\u9009\u9879\uff1a\u5176\u4ed6/\u6b21\u8981\u9053\u8def/\u4e3b\u8981\u9053\u8def/\u80cc\u8857\u5c0f\u5df7),\n(\u95ee\u9898\u63cf\u8ff0:text, \u5305\u542b\u5177\u4f53\u5730\u70b9\u7684\u8be6\u7ec6\u95ee\u9898\u63cf\u8ff0\uff0c\u6bd4\u5982\u201c\u6619\u82b1\u5eb5\u8def \u6619\u82b1\u5eb5\u8def96\u53f7\u4eba\u884c\u9053\u7eff\u5316\u5e26\u4e0d\u6d01\u201c),\n(\u95ee\u9898\u6765\u6e90:text, \u95ee\u9898\u6765\u6e90\uff0c\u5206\u4e3a\u201c\u4fe1\u606f\u91c7\u96c6\u5458\u4e0a\u62a5\u201d\u548c\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u6807\u8bb0:text),\n(\u95ee\u9898\u72b6\u6001:text),\n(\u5904\u7f6e\u7ed3\u675f\u65f6\u95f4:text),\n(id:bigint),\n(\u95ee\u9898\u7b49\u7ea7\u540d\u79f0:double),\n(\u9996\u6b21\u6838\u67e5\u53d1\u9001\u65f6\u95f4:text),\n(\u95ee\u9898\u7c7b\u578b:text, \u95ee\u9898\u7c7b\u578b\uff0c\u5206\u4e3a\u201c\u4e8b\u4ef6\u201d\u201c\u90e8\u4ef6\u201d\u201c\u6709\u5956\u4e3e\u62a5\u201d\u7b49),\n(\u95ee\u9898\u7ea7\u522b\u540d\u79f0:text),\n(\u9636\u6bb5\u622a\u6b62\u65f6\u95f4:text, \u8fd9\u4e2a\u5b57\u6bb5\u7684\u683c\u5f0f\u793a\u4f8b\u662f\u201c2025-07-23 17:30:00\u201d),\n(imported_at:timestamp)\n]\n", "cosine_similarity": 0.4611400570913274}, {"id": 3, "schema_table": "# Table: sql_examples, SQL\u793a\u4f8b\u4e3b\u8868\n[\n(create_time:timestamp, \u521b\u5efa\u65f6\u95f4),\n(description:text, \u989d\u5916\u63cf\u8ff0\u4fe1\u606f\uff0c\u53ef\u9009),\n(enabled:tinyint, \u662f\u5426\u542f\u7528\uff0c\u7528\u4e8e\u8f6f\u5220\u9664),\n(id:bigint, \u793a\u4f8bID),\n(question:text, \u95ee\u9898\u63cf\u8ff0\uff0c\u7528\u6237\u7684\u81ea\u7136\u8bed\u8a00\u95ee\u9898),\n(sql_statement:text, SQL\u8bed\u53e5\uff0c\u5bf9\u5e94\u7684\u6807\u51c6SQL),\n(update_time:timestamp, \u66f4\u65b0\u65f6\u95f4),\n(user_id:varchar, \u7528\u6237ID\uff0c\u7528\u4e8e\u591a\u7528\u6237\u9694\u79bb)\n]\n", "cosine_similarity": 0.38975755044989446}, {"id": 2, "schema_table": "# Table: sql_example_tables, SQL\u793a\u4f8b\u8868\u5173\u8054\u5173\u7cfb\n[\n(example_id:bigint, \u5173\u8054sql_examples.id),\n(id:bigint, \u5173\u8054ID),\n(table_alias:varchar, \u8868\u522b\u540d\uff0cSQL\u4e2d\u4f7f\u7528\u7684\u522b\u540d),\n(table_name:varchar, \u6570\u636e\u5e93\u8868\u540d),\n(usage_type:enum, \u8868\u7684\u4f7f\u7528\u65b9\u5f0f)\n]\n", "cosine_similarity": 0.3833513059094066}]
2025-12-25 13:42:43,773 - apps.db.db - INFO:145 - success
2025-12-25 13:42:45,501 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-25 13:42:45,503 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,504 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,536 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,640 - apps.chat.task.llm - INFO:1374 - content='  "success' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,663 - apps.chat.task.llm - INFO:1374 - content='": true,\n' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,767 - apps.chat.task.llm - INFO:1374 - content='  "sql": "SELECT' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,830 - apps.chat.task.llm - INFO:1374 - content=' `区域名称` AS `' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:45,937 - apps.chat.task.llm - INFO:1374 - content='district_name`, COUNT' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,019 - apps.chat.task.llm - INFO:1374 - content='(*) AS `case_count`' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,107 - apps.chat.task.llm - INFO:1374 - content=' FROM `digital_urban_management' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,188 - apps.chat.task.llm - INFO:1374 - content='_cases` WHERE `小' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,253 - apps.chat.task.llm - INFO:1374 - content="类名称` = '无" additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,359 - apps.chat.task.llm - INFO:1374 - content="照经营游商' GROUP" additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,449 - apps.chat.task.llm - INFO:1374 - content=' BY `区域名称` ORDER' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,536 - apps.chat.task.llm - INFO:1374 - content=' BY `case_count` DESC' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,591 - apps.chat.task.llm - INFO:1374 - content=' LIMIT 1000' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,701 - apps.chat.task.llm - INFO:1374 - content='000",\n' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,778 - apps.chat.task.llm - INFO:1374 - content='  "tables": ["digital' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,869 - apps.chat.task.llm - INFO:1374 - content='_urban_management_cases"],\n ' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:46,950 - apps.chat.task.llm - INFO:1374 - content=' "chart-type": "bar' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:47,013 - apps.chat.task.llm - INFO:1374 - content='"\n}\n```' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:47,033 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297'
2025-12-25 13:42:47,034 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--e94acc25-6049-4840-938c-0cfb8ce0d297' usage_metadata={'input_tokens': 4199, 'output_tokens': 98, 'total_tokens': 4297, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-25 13:42:47,059 - apps.chat.task.llm - INFO:986 - ```json
{
  "success": true,
  "sql": "SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000",
  "tables": ["digital_urban_management_cases"],
  "chart-type": "bar"
}
```
2025-12-25 13:42:47,064 - apps.chat.task.llm - INFO:1019 - sql: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-25 13:42:47,067 - apps.chat.task.llm - INFO:867 - Executing SQL on ds_id 1: SELECT `区域名称` AS `district_name`, COUNT(*) AS `case_count` FROM `digital_urban_management_cases` WHERE `小类名称` = '无照经营游商' GROUP BY `区域名称` ORDER BY `case_count` DESC LIMIT 1000000
2025-12-25 13:42:49,905 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-25 13:42:49,906 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:49,907 - apps.chat.task.llm - INFO:1374 - content='```' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:49,970 - apps.chat.task.llm - INFO:1374 - content='json\n{\n' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,086 - apps.chat.task.llm - INFO:1374 - content='  "type' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,156 - apps.chat.task.llm - INFO:1374 - content='": "bar' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,257 - apps.chat.task.llm - INFO:1374 - content='",\n  "title": "' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,368 - apps.chat.task.llm - INFO:1374 - content='无照经营游商案件' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,517 - apps.chat.task.llm - INFO:1374 - content='数量",\n  "axis":' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,637 - apps.chat.task.llm - INFO:1374 - content=' {\n    "x": {\n' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,776 - apps.chat.task.llm - INFO:1374 - content='      "name": "区域' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:50,909 - apps.chat.task.llm - INFO:1374 - content='名称",\n      "value":' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:51,045 - apps.chat.task.llm - INFO:1374 - content=' "district_name"\n   ' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:51,173 - apps.chat.task.llm - INFO:1374 - content=' },\n    "y": {\n' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:51,297 - apps.chat.task.llm - INFO:1374 - content='      "name": "案件' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:51,806 - apps.chat.task.llm - INFO:1374 - content='数量",\n      "value":' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:51,930 - apps.chat.task.llm - INFO:1374 - content=' "case_count"\n    }\n' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:52,034 - apps.chat.task.llm - INFO:1374 - content='  }\n}\n```' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:52,056 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251'
2025-12-25 13:42:52,057 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--dcd00a0e-fab8-490e-9df9-d39c2bf54251' usage_metadata={'input_tokens': 2213, 'output_tokens': 79, 'total_tokens': 2292, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-25 13:42:52,078 - apps.chat.task.llm - INFO:1094 - ```json
{
  "type": "bar",
  "title": "无照经营游商案件数量",
  "axis": {
    "x": {
      "name": "区域名称",
      "value": "district_name"
    },
    "y": {
      "name": "案件数量",
      "value": "case_count"
    }
  }
}
```
2025-12-25 13:42:52,084 - apps.chat.task.llm - INFO:1096 - {'type': 'bar', 'title': '无照经营游商案件数量', 'axis': {'x': {'name': '区域名称', 'value': 'district_name'}, 'y': {'name': '案件数量', 'value': 'case_count'}}}
2025-12-25 13:42:52,884 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-25 13:42:52,886 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:52,887 - apps.chat.task.llm - INFO:1374 - content='["' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:52,937 - apps.chat.task.llm - INFO:1374 - content='2' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,001 - apps.chat.task.llm - INFO:1374 - content='025' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,065 - apps.chat.task.llm - INFO:1374 - content='年6月' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,194 - apps.chat.task.llm - INFO:1374 - content='余杭区非“正常' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,350 - apps.chat.task.llm - INFO:1374 - content='结案”的案件有多少起' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,517 - apps.chat.task.llm - INFO:1374 - content='？","小营街道负责' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,664 - apps.chat.task.llm - INFO:1374 - content='处置的案件分布在哪些区域' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,776 - apps.chat.task.llm - INFO:1374 - content='？","无照经营游' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:53,920 - apps.chat.task.llm - INFO:1374 - content='商案件的上报时间分布' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:54,029 - apps.chat.task.llm - INFO:1374 - content='是怎样的","萧' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:54,186 - apps.chat.task.llm - INFO:1374 - content='山区市容环境大类' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:54,286 - apps.chat.task.llm - INFO:1374 - content='的所有案件的数量"]' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:54,307 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--8e787f72-bf90-4303-8312-1da530c9c06d'
2025-12-25 13:42:54,309 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--8e787f72-bf90-4303-8312-1da530c9c06d' usage_metadata={'input_tokens': 1521, 'output_tokens': 59, 'total_tokens': 1580, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-25 13:43:11,049 - httpx - INFO:1025 - HTTP Request: POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions "HTTP/1.1 200 OK"
2025-12-25 13:43:11,050 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,051 - apps.chat.task.llm - INFO:1374 - content='抱歉' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,108 - apps.chat.task.llm - INFO:1374 - content='，该数据' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,173 - apps.chat.task.llm - INFO:1374 - content='无法进行预测' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,237 - apps.chat.task.llm - INFO:1374 - content='。原因' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,443 - apps.chat.task.llm - INFO:1374 - content='在于提供的数据是' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,550 - apps.chat.task.llm - INFO:1374 - content='各个区域的案件' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,755 - apps.chat.task.llm - INFO:1374 - content='数量分布情况，并' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:11,923 - apps.chat.task.llm - INFO:1374 - content='没有展示出时间' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:12,136 - apps.chat.task.llm - INFO:1374 - content='序列上的趋势变化' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:12,363 - apps.chat.task.llm - INFO:1374 - content='，因此不适合做' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:12,509 - apps.chat.task.llm - INFO:1374 - content='基于时间序列的趋势' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:12,553 - apps.chat.task.llm - INFO:1374 - content='预测。' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:12,578 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={'finish_reason': 'stop', 'model_name': 'qwen-max'} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1'
2025-12-25 13:43:12,580 - apps.chat.task.llm - INFO:1374 - content='' additional_kwargs={} response_metadata={} id='run--e52e6306-d4cc-43e6-82fb-16f9a8ef5ed1' usage_metadata={'input_tokens': 566, 'output_tokens': 39, 'total_tokens': 605, 'input_token_details': {'cache_read': 0}, 'output_token_details': {}}
2025-12-25 13:49:41,539 - apps.datasource.crud.table - INFO:116 - start datasource embedding
2025-12-25 13:49:41,790 - apps.datasource.crud.table - INFO:157 - datasource embedding finished in: 0.24875116348266602 seconds
2025-12-30 11:23:20,747 - main - INFO:55 - SQLBot 应用关闭
