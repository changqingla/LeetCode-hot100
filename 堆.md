# å †ä¸“é¢˜

## ğŸ” å †åŸºç¡€çŸ¥è¯†

### ğŸ“– å®šä¹‰

**å †**ï¼ˆHeapï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„å®Œå…¨äºŒå‰æ ‘æ•°æ®ç»“æ„ï¼Œé€šå¸¸åˆ†ä¸º**å¤§é¡¶å †**ï¼ˆæœ€å¤§å †ï¼‰å’Œ**å°é¡¶å †**ï¼ˆæœ€å°å †ï¼‰ã€‚å †çš„æ ¸å¿ƒç‰¹æ€§æ˜¯çˆ¶èŠ‚ç‚¹çš„å€¼æ€»æ˜¯å¤§äºï¼ˆå¤§é¡¶å †ï¼‰æˆ–å°äºï¼ˆå°é¡¶å †ï¼‰å­èŠ‚ç‚¹çš„å€¼ã€‚

### âš¡ æ ¸å¿ƒç‰¹å¾

1. **å®Œå…¨äºŒå‰æ ‘**ï¼šé™¤äº†æœ€åä¸€å±‚ï¼Œå…¶ä»–å±‚éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åä¸€å±‚ä»å·¦å¼€å§‹å¡«å……
2. **å †åºæ€§**ï¼šçˆ¶èŠ‚ç‚¹çš„å€¼å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å­èŠ‚ç‚¹çš„å€¼
3. **åŠ¨æ€ç»´æŠ¤**ï¼šæ’å…¥å’Œåˆ é™¤æ“ä½œåä»ä¿æŒå †çš„æ€§è´¨

### ğŸ¯ å †çš„ç±»å‹

#### 1. å¤§é¡¶å †ï¼ˆMax Heapï¼‰
```python
# çˆ¶èŠ‚ç‚¹çš„å€¼ >= å­èŠ‚ç‚¹çš„å€¼
# å †é¡¶æ˜¯æœ€å¤§å€¼
```

#### 2. å°é¡¶å †ï¼ˆMin Heapï¼‰
```python
# çˆ¶èŠ‚ç‚¹çš„å€¼ <= å­èŠ‚ç‚¹çš„å€¼
# å †é¡¶æ˜¯æœ€å°å€¼
```

### ğŸ Pythonå †å®ç°

```python
import heapq

# åˆ›å»ºå°é¡¶å †
heap = []

# åŸºæœ¬æ“ä½œ
heapq.heappush(heap, 3)  # æ’å…¥å…ƒç´ 
heapq.heappush(heap, 1)
heapq.heappush(heap, 4)

min_val = heapq.heappop(heap)  # å¼¹å‡ºæœ€å°å€¼

# å¤§é¡¶å †å®ç°ï¼ˆä½¿ç”¨è´Ÿæ•°ï¼‰
max_heap = []
heapq.heappush(max_heap, -3)
heapq.heappush(max_heap, -1)
heapq.heappush(max_heap, -4)
max_val = -heapq.heappop(max_heap)  # å¼¹å‡ºæœ€å¤§å€¼

# è·å–å‰kä¸ªæœ€å¤§å…ƒç´ 
nums = [1, 3, 4, 2, 5]
k_largest = heapq.nlargest(3, nums)  # [5, 4, 3]
k_smallest = heapq.nsmallest(3, nums)  # [1, 2, 3]
```

### ğŸ“ å †çš„æ—¶é—´å¤æ‚åº¦

- **æ’å…¥**ï¼šO(log n)
- **åˆ é™¤**ï¼šO(log n)
- **æŸ¥æ‰¾æœ€å¤§/æœ€å°å€¼**ï¼šO(1)
- **å»ºå †**ï¼šO(n)

### ğŸ“ å †çš„åº”ç”¨åœºæ™¯

- **ä¼˜å…ˆé˜Ÿåˆ—**ï¼šä»»åŠ¡è°ƒåº¦ã€äº‹ä»¶å¤„ç†
- **Top Ké—®é¢˜**ï¼šå‰Kå¤§ã€å‰Kå°å…ƒç´ 
- **ä¸­ä½æ•°ç»´æŠ¤**ï¼šæ•°æ®æµä¸­ä½æ•°
- **æ’åº**ï¼šå †æ’åº
- **åˆå¹¶Kä¸ªæœ‰åºåˆ—è¡¨**ï¼šå¤šè·¯å½’å¹¶

---

## ğŸ“‹ é¢˜ç›®ç›®å½•

| é¢˜å· | é¢˜ç›®åç§° | éš¾åº¦ | æ ¸å¿ƒæŠ€å·§ |
|------|----------|------|----------|
| 215 | æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´  | ä¸­ç­‰ | å¿«é€Ÿé€‰æ‹©/å † |
| 347 | å‰Kä¸ªé«˜é¢‘å…ƒç´  | ä¸­ç­‰ | å †+å“ˆå¸Œè¡¨ |
| 295 | æ•°æ®æµçš„ä¸­ä½æ•° | å›°éš¾ | åŒå † |

---

## 215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ 

**é¢˜ç›®æè¿°ï¼š**

ç»™å®šæ•´æ•°æ•°ç»„ nums å’Œæ•´æ•° kï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚

è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ k ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ k ä¸ªä¸åŒçš„å…ƒç´ ã€‚

ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚

**æµ‹è¯•ç”¨ä¾‹ï¼š**

```
ç¤ºä¾‹ 1ï¼š
è¾“å…¥: [3,2,1,5,6,4], k = 2
è¾“å‡º: 5

ç¤ºä¾‹ 2ï¼š
è¾“å…¥: [3,2,3,1,2,4,5,5,6], k = 4
è¾“å‡º: 4
```

**æœ€ç®€å•å®ç°ï¼š**

```python
import heapq

def findKthLargest(nums, k):
    """
    ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ï¼šä½¿ç”¨å°é¡¶å †

    æ€è·¯ï¼š
    1. ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°é¡¶å †
    2. éå†æ•°ç»„ï¼Œå°†å…ƒç´ åŠ å…¥å †
    3. å¦‚æœå †å¤§å°è¶…è¿‡kï¼Œå¼¹å‡ºæœ€å°å…ƒç´ 
    4. æœ€ç»ˆå †é¡¶å°±æ˜¯ç¬¬kå¤§çš„å…ƒç´ 

    æ—¶é—´å¤æ‚åº¦ï¼šO(n log k)
    ç©ºé—´å¤æ‚åº¦ï¼šO(k)
    """
    if not nums or k > len(nums):
        return None

    # åˆ›å»ºå°é¡¶å †ï¼Œå­˜å‚¨æœ€å¤§çš„kä¸ªå…ƒç´ 
    heap = []

    for num in nums:
        heapq.heappush(heap, num)
        # ä¿æŒå †çš„å¤§å°ä¸ºk
        if len(heap) > k:
            heapq.heappop(heap)

    # å †é¡¶æ˜¯æœ€å°çš„é‚£ä¸ªï¼ˆç¬¬kå¤§çš„å…ƒç´ ï¼‰
    return heap[0]

# å¿«é€Ÿé€‰æ‹©ç®—æ³•ï¼ˆå¹³å‡O(n)æ—¶é—´å¤æ‚åº¦ï¼‰
def findKthLargestQuickSelect(nums, k):
    """
    å¿«é€Ÿé€‰æ‹©ç®—æ³•ï¼šåŸºäºå¿«é€Ÿæ’åºçš„åˆ†åŒºæ€æƒ³

    æ—¶é—´å¤æ‚åº¦ï¼šå¹³å‡O(n)ï¼Œæœ€åO(nÂ²)
    ç©ºé—´å¤æ‚åº¦ï¼šO(1)
    """
    def partition(left, right, pivot_index):
        pivot = nums[pivot_index]
        # å°†pivotç§»åˆ°æœ«å°¾
        nums[pivot_index], nums[right] = nums[right], nums[pivot_index]

        # åˆ†åŒº
        store_index = left
        for i in range(left, right):
            if nums[i] > pivot:  # æ‰¾ç¬¬kå¤§ï¼Œæ‰€ä»¥å¤§çš„å…ƒç´ æ”¾å‰é¢
                nums[store_index], nums[i] = nums[i], nums[store_index]
                store_index += 1

        # å°†pivotæ”¾å›æ­£ç¡®ä½ç½®
        nums[right], nums[store_index] = nums[store_index], nums[right]
        return store_index

    def quick_select(left, right, k_smallest):
        """
        å¯»æ‰¾ç¬¬k_smallestå°çš„å…ƒç´ ï¼ˆå¯¹åº”ç¬¬kå¤§çš„å…ƒç´ ï¼‰
        """
        if left == right:
            return nums[left]

        # éšæœºé€‰æ‹©pivot
        pivot_index = left + (right - left) // 2
        pivot_index = partition(left, right, pivot_index)

        if k_smallest == pivot_index:
            return nums[k_smallest]
        elif k_smallest < pivot_index:
            return quick_select(left, pivot_index - 1, k_smallest)
        else:
            return quick_select(pivot_index + 1, right, k_smallest)

    n = len(nums)
    # æ‰¾ç¬¬kå¤§çš„å…ƒç´ ï¼Œç›¸å½“äºæ‰¾ç¬¬(n-k+1)å°çš„å…ƒç´ 
    return quick_select(0, n - 1, n - k)

# æµ‹è¯•ç”¨ä¾‹
print(findKthLargest([3,2,1,5,6,4], 2))      # è¾“å‡º: 5
print(findKthLargest([3,2,3,1,2,4,5,5,6], 4)) # è¾“å‡º: 4
```

**è§£é¢˜æ€è·¯è¯¦è§£ï¼š**

è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**Top Ké—®é¢˜**çš„ç»å…¸è§£æ³•ï¼š

**æ–¹æ³•ä¸€ï¼šå †æ’åº**
- ä½¿ç”¨å°é¡¶å †ç»´æŠ¤æœ€å¤§çš„kä¸ªå…ƒç´ 
- å †é¡¶å§‹ç»ˆæ˜¯ç¬¬kå¤§çš„å…ƒç´ 
- é€‚åˆkç›¸å¯¹è¾ƒå°çš„æƒ…å†µ

**æ–¹æ³•äºŒï¼šå¿«é€Ÿé€‰æ‹©**
- åŸºäºå¿«é€Ÿæ’åºçš„åˆ†åŒºæ€æƒ³
- å¹³å‡æ—¶é—´å¤æ‚åº¦O(n)
- æœ€åæƒ…å†µO(nÂ²)ï¼Œä½†å®è·µä¸­è¡¨ç°è‰¯å¥½

**å †æ–¹æ³•æµç¨‹ï¼š**
1. åˆ›å»ºå°é¡¶å †
2. éå†æ•°ç»„ï¼ŒåŠ å…¥å †
3. ä¿æŒå †å¤§å°ä¸ºk
4. è¿”å›å †é¡¶å…ƒç´ 

**ä¸¾ä¾‹è¯´æ˜ï¼š**
```
nums = [3,2,1,5,6,4], k = 2

åˆå§‹åŒ–å †ï¼š[]

åŠ å…¥3ï¼šheap=[3]
åŠ å…¥2ï¼šheap=[2,3]ï¼Œå¼¹å‡ºæœ€å°2ï¼Œheap=[3]
åŠ å…¥1ï¼šheap=[1,3]ï¼Œå¼¹å‡ºæœ€å°1ï¼Œheap=[3]
åŠ å…¥5ï¼šheap=[3,5]ï¼Œå¼¹å‡ºæœ€å°3ï¼Œheap=[5]
åŠ å…¥6ï¼šheap=[5,6]ï¼Œå¼¹å‡ºæœ€å°5ï¼Œheap=[6]
åŠ å…¥4ï¼šheap=[4,6]ï¼Œå¼¹å‡ºæœ€å°4ï¼Œheap=[6]

æœ€ç»ˆheap=[6]ï¼Œç¬¬2å¤§çš„å…ƒç´ æ˜¯6ï¼Ÿç­‰ç­‰ï¼Œè¿™ä¸å¯¹å•Šï¼

ç­‰ç­‰ï¼Œæˆ‘æé”™äº†ã€‚åº”è¯¥æ˜¯ç»´æŠ¤æœ€å¤§çš„kä¸ªå…ƒç´ ï¼Œä½¿ç”¨å°é¡¶å †çš„è¯ï¼Œå †é¡¶æ˜¯æœ€å°çš„é‚£ä¸ªã€‚
å¯¹äºç¬¬kå¤§çš„å…ƒç´ ï¼Œæˆ‘ä»¬åº”è¯¥ï¼š
- ä½¿ç”¨å¤§é¡¶å †ç»´æŠ¤æœ€å°çš„(n-k+1)ä¸ªå…ƒç´ 
- æˆ–è€…ä½¿ç”¨å°é¡¶å †ç»´æŠ¤æœ€å¤§çš„kä¸ªå…ƒç´ 

è®©æˆ‘é‡æ–°æ€è€ƒ...

å¯¹äºç¬¬kå¤§çš„å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æ’åºåç¬¬kå¤§çš„å…ƒç´ ã€‚
ä½¿ç”¨å°é¡¶å †ï¼š
- ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸ºkçš„å°é¡¶å †
- éå†æ•°ç»„ï¼Œå°†æ¯ä¸ªå…ƒç´ åŠ å…¥å †
- å¦‚æœå †å¤§å°è¶…è¿‡kï¼Œå¼¹å‡ºå †é¡¶ï¼ˆæœ€å°çš„ï¼‰
- æœ€ç»ˆå †ä¸­æ˜¯æœ€å¤§çš„kä¸ªå…ƒç´ ï¼Œå †é¡¶æ˜¯æœ€å°çš„é‚£ä¸ªï¼Œå³ç¬¬kå¤§çš„å…ƒç´ 

é‡æ–°æ¥ï¼š
nums = [3,2,1,5,6,4], k = 2

åŠ å…¥3ï¼šheap=[3]
åŠ å…¥2ï¼šheap=[2,3]ï¼Œå¤§å°=2
åŠ å…¥1ï¼šheap=[1,3]ï¼Œå¤§å°=2
åŠ å…¥5ï¼šheap=[1,3,5]ï¼Œå¼¹å‡º1ï¼Œheap=[3,5]
åŠ å…¥6ï¼šheap=[3,5,6]ï¼Œå¼¹å‡º3ï¼Œheap=[5,6]
åŠ å…¥4ï¼šheap=[4,5,6]ï¼Œå¼¹å‡º4ï¼Œheap=[5,6]

heap=[5,6]ï¼Œå †é¡¶5æ˜¯ç¬¬2å¤§çš„å…ƒç´  âœ“
```

**æ—¶é—´å¤æ‚åº¦è¯æ˜ï¼š**
- å †æ“ä½œï¼šæ¯æ¬¡O(log k)
- æ€»å…±næ¬¡æ“ä½œï¼šO(n log k)
- å½“kè¾ƒå°æ—¶æ¥è¿‘O(n)

---

## 347. å‰Kä¸ªé«˜é¢‘å…ƒç´ 

**é¢˜ç›®æè¿°ï¼š**

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªæ•´æ•° k ï¼Œè¯·ä½ è¿”å›å…¶ä¸­å‡ºç°é¢‘ç‡å‰ k é«˜çš„å…ƒç´ ã€‚ä½ å¯ä»¥æŒ‰ ä»»æ„é¡ºåº è¿”å›ç­”æ¡ˆã€‚

**æµ‹è¯•ç”¨ä¾‹ï¼š**

```
ç¤ºä¾‹ 1ï¼š
è¾“å…¥ï¼šnums = [1,1,1,2,2,3], k = 2
è¾“å‡ºï¼š[1,2]

ç¤ºä¾‹ 2ï¼š
è¾“å…¥ï¼šnums = [1], k = 1
è¾“å‡ºï¼š[1]

ç¤ºä¾‹ 3ï¼š
è¾“å…¥ï¼šnums = [1,2,1,2,1,2,3,1,3,2], k = 2
è¾“å‡ºï¼š[1,2]
```

**æœ€ç®€å•å®ç°ï¼š**

```python
import heapq
from collections import Counter

def topKFrequent(nums, k):
    """
    å‰Kä¸ªé«˜é¢‘å…ƒç´ ï¼šä½¿ç”¨å †

    æ€è·¯ï¼š
    1. ä½¿ç”¨Counterç»Ÿè®¡é¢‘ç‡
    2. ä½¿ç”¨å°é¡¶å †ç»´æŠ¤é¢‘ç‡æœ€é«˜çš„å‰kä¸ªå…ƒç´ 
    3. å †ä¸­å­˜å‚¨(-é¢‘ç‡, å…ƒç´ )çš„å…ƒç»„ï¼Œå®ç°å¤§é¡¶å †æ•ˆæœ

    æ—¶é—´å¤æ‚åº¦ï¼šO(n log k)
    ç©ºé—´å¤æ‚åº¦ï¼šO(n)
    """
    if not nums or k == 0:
        return []

    # ç»Ÿè®¡é¢‘ç‡
    freq_map = Counter(nums)

    # ä½¿ç”¨å°é¡¶å †ï¼Œå­˜å‚¨(-é¢‘ç‡, å…ƒç´ )
    # è¿™æ ·å †é¡¶æ˜¯æœ€å°é¢‘ç‡çš„å…ƒç´ 
    heap = []

    for num, freq in freq_map.items():
        heapq.heappush(heap, (-freq, num))
        # ä¿æŒå †å¤§å°ä¸ºk
        if len(heap) > k:
            heapq.heappop(heap)

    # æå–ç»“æœ
    result = [num for neg_freq, num in heap]
    return result

# å¦ä¸€ç§å®ç°ï¼šå…ˆæ’åºåå–å‰k
def topKFrequentSort(nums, k):
    """
    å…ˆç»Ÿè®¡å†æ’åº

    æ—¶é—´å¤æ‚åº¦ï¼šO(n log n)
    ç©ºé—´å¤æ‚åº¦ï¼šO(n)
    """
    freq_map = Counter(nums)

    # æŒ‰é¢‘ç‡é™åºæ’åº
    sorted_items = sorted(freq_map.items(), key=lambda x: x[1], reverse=True)

    # å–å‰kä¸ª
    return [item[0] for item in sorted_items[:k]]

# æµ‹è¯•ç”¨ä¾‹
print(topKFrequent([1,1,1,2,2,3], 2))            # è¾“å‡º: [1,2] æˆ– [2,1]
print(topKFrequent([1], 1))                        # è¾“å‡º: [1]
print(topKFrequent([1,2,1,2,1,2,3,1,3,2], 2))    # è¾“å‡º: [1,2] æˆ– [2,1]
```

**è§£é¢˜æ€è·¯è¯¦è§£ï¼š**

è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯**é¢‘ç‡ç»Ÿè®¡ + Top Ké—®é¢˜**ï¼š

**æ ¸å¿ƒåŸç†ï¼š**
- ç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„å‡ºç°é¢‘ç‡
- ä»é¢‘ç‡æœ€é«˜çš„å…ƒç´ ä¸­é€‰æ‹©å‰kä¸ª
- ä½¿ç”¨å †æ¥ç»´æŠ¤Top Kå…ƒç´ 

**ç®—æ³•æµç¨‹ï¼š**
1. ä½¿ç”¨Counterç»Ÿè®¡é¢‘ç‡
2. åˆ›å»ºå°é¡¶å †ï¼Œå­˜å‚¨(-é¢‘ç‡, å…ƒç´ )çš„å…ƒç»„
3. éå†é¢‘ç‡æ˜ å°„ï¼Œå°†å…ƒç´ åŠ å…¥å †
4. ä¿æŒå †å¤§å°ä¸ºk
5. è¿”å›å †ä¸­çš„å…ƒç´ 

**ä¸ºä»€ä¹ˆä½¿ç”¨(-é¢‘ç‡, å…ƒç´ )ï¼Ÿ**
- heapqæ˜¯å°é¡¶å †ï¼Œå †é¡¶æ˜¯æœ€å°çš„å…ƒç´ 
- -é¢‘ç‡è®©é¢‘ç‡é«˜çš„å…ƒç´ æ’åœ¨å‰é¢
- é¢‘ç‡ç›¸åŒæ—¶ï¼ŒæŒ‰å…ƒç´ å€¼æ’åº

**ä¸¾ä¾‹è¯´æ˜ï¼š**
```
nums = [1,1,1,2,2,3], k = 2

freq_map = {1: 3, 2: 2, 3: 1}

åŠ å…¥(1,3)ï¼šheap=[(-3,1)]
åŠ å…¥(2,2)ï¼šheap=[(-3,1), (-2,2)]
åŠ å…¥(3,1)ï¼šheap=[(-3,1), (-2,2), (-1,3)]ï¼Œå¼¹å‡º(-1,3)ï¼Œheap=[(-3,1), (-2,2)]

æœ€ç»ˆç»“æœï¼š[1,2] âœ“
```

**æ—¶é—´å¤æ‚åº¦è¯æ˜ï¼š**
- ç»Ÿè®¡é¢‘ç‡ï¼šO(n)
- å †æ“ä½œï¼šO(n log k)
- æ€»å¤æ‚åº¦ï¼šO(n log k)

---

## 295. æ•°æ®æµçš„ä¸­ä½æ•°

**é¢˜ç›®æè¿°ï¼š**

ä¸­ä½æ•°æ˜¯æœ‰åºæ•´æ•°åˆ—è¡¨ä¸­çš„ä¸­é—´å€¼ã€‚å¦‚æœåˆ—è¡¨çš„å¤§å°æ˜¯å¶æ•°ï¼Œåˆ™æ²¡æœ‰ä¸­é—´å€¼ï¼Œä¸­ä½æ•°æ˜¯ä¸¤ä¸ªä¸­é—´å€¼çš„å¹³å‡å€¼ã€‚

ä¾‹å¦‚ arr = [2,3,4] çš„ä¸­ä½æ•°æ˜¯ 3 ã€‚
ä¾‹å¦‚ arr = [2,3] çš„ä¸­ä½æ•°æ˜¯ (2 + 3) / 2 = 2.5 ã€‚

å®ç° MedianFinder ç±»:

MedianFinder() åˆå§‹åŒ– MedianFinder å¯¹è±¡ã€‚

void addNum(int num) å°†æ•°æ®æµä¸­çš„æ•´æ•° num æ·»åŠ åˆ°æ•°æ®ç»“æ„ä¸­ã€‚

double findMedian() è¿”å›åˆ°ç›®å‰ä¸ºæ­¢æ‰€æœ‰å…ƒç´ çš„ä¸­ä½æ•°ã€‚ä¸å®é™…ç­”æ¡ˆç›¸å·® 10-5 ä»¥å†…çš„ç­”æ¡ˆå°†è¢«æ¥å—ã€‚

**æµ‹è¯•ç”¨ä¾‹ï¼š**

```
ç¤ºä¾‹ 1ï¼š
è¾“å…¥
["MedianFinder", "addNum", "addNum", "findMedian", "addNum", "findMedian"]
[[], [1], [2], [], [3], []]

è¾“å‡º
[null, null, null, 1.5, null, 2.0]

è§£é‡Š
MedianFinder medianFinder = new MedianFinder();
medianFinder.addNum(1);    // arr = [1]
medianFinder.addNum(2);    // arr = [1, 2]
medianFinder.findMedian(); // è¿”å› 1.5 ((1 + 2) / 2)
medianFinder.addNum(3);    // arr[1, 2, 3]
medianFinder.findMedian(); // return 2.0
```

**æœ€ç®€å•å®ç°ï¼š**

```python
import heapq

class MedianFinder:
    """
    æ•°æ®æµçš„ä¸­ä½æ•°ï¼šä½¿ç”¨åŒå †

    æ€è·¯ï¼š
    1. ä½¿ç”¨å¤§é¡¶å †å­˜å‚¨è¾ƒå°çš„ä¸€åŠæ•°å­—
    2. ä½¿ç”¨å°é¡¶å †å­˜å‚¨è¾ƒå¤§çš„ä¸€åŠæ•°å­—
    3. ä¿æŒä¸¤ä¸ªå †çš„å¤§å°å·®ä¸è¶…è¿‡1
    4. å¤§é¡¶å †å †é¡¶æ˜¯è¾ƒå°ä¸€åŠçš„æœ€å¤§å€¼
    5. å°é¡¶å †å †é¡¶æ˜¯è¾ƒå¤§ä¸€åŠçš„æœ€å°å€¼

    æ—¶é—´å¤æ‚åº¦ï¼šaddNum O(log n), findMedian O(1)
    ç©ºé—´å¤æ‚åº¦ï¼šO(n)
    """

    def __init__(self):
        # å¤§é¡¶å †ï¼šå­˜å‚¨è¾ƒå°çš„ä¸€åŠï¼Œä½¿ç”¨è´Ÿæ•°å®ç°
        self.max_heap = []  # å­˜å‚¨è¾ƒå°çš„ä¸€åŠï¼Œå †é¡¶æ˜¯æœ€å¤§å€¼
        # å°é¡¶å †ï¼šå­˜å‚¨è¾ƒå¤§çš„ä¸€åŠ
        self.min_heap = []  # å­˜å‚¨è¾ƒå¤§çš„ä¸€åŠï¼Œå †é¡¶æ˜¯æœ€å°å€¼

    def addNum(self, num: int) -> None:
        # å…ˆæ·»åŠ åˆ°å¤§é¡¶å †ï¼ˆè¾ƒå°çš„ä¸€åŠï¼‰
        heapq.heappush(self.max_heap, -num)

        # å°†å¤§é¡¶å †çš„æœ€å¤§å€¼ç§»åŠ¨åˆ°å°é¡¶å †
        heapq.heappush(self.min_heap, -heapq.heappop(self.max_heap))

        # ä¿æŒå¤§é¡¶å †çš„å¤§å° >= å°é¡¶å †çš„å¤§å°
        if len(self.min_heap) > len(self.max_heap):
            heapq.heappush(self.max_heap, -heapq.heappop(self.min_heap))

    def findMedian(self) -> float:
        if len(self.max_heap) > len(self.min_heap):
            # æ€»æ•°ä¸ºå¥‡æ•°ï¼Œä¸­ä½æ•°æ˜¯å¤§é¡¶å †å †é¡¶
            return -self.max_heap[0]
        else:
            # æ€»æ•°ä¸ºå¶æ•°ï¼Œä¸­ä½æ•°æ˜¯ä¸¤ä¸ªå †é¡¶çš„å¹³å‡å€¼
            return (-self.max_heap[0] + self.min_heap[0]) / 2

# æµ‹è¯•ç”¨ä¾‹
medianFinder = MedianFinder()
medianFinder.addNum(1)
medianFinder.addNum(2)
print(medianFinder.findMedian())  # è¾“å‡º: 1.5
medianFinder.addNum(3)
print(medianFinder.findMedian())  # è¾“å‡º: 2.0
```

**è§£é¢˜æ€è·¯è¯¦è§£ï¼š**

è¿™é“é¢˜çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨**åŒå †**ç»´æŠ¤æ•°æ®æµçš„ä¸­ä½æ•°ï¼š

**æ ¸å¿ƒåŸç†ï¼š**
- å¤§é¡¶å †å­˜å‚¨è¾ƒå°çš„ä¸€åŠæ•°å­—
- å°é¡¶å †å­˜å‚¨è¾ƒå¤§çš„ä¸€åŠæ•°å­—
- ä¸­ä½æ•°æ€»æ˜¯ä¸¤ä¸ªå †é¡¶ä¹‹ä¸€æˆ–å®ƒä»¬çš„å¹³å‡å€¼

**æ•°æ®ç»“æ„è®¾è®¡ï¼š**
- max_heapï¼ˆå¤§é¡¶å †ï¼‰ï¼šå­˜å‚¨è¾ƒå°çš„ä¸€åŠï¼Œä½¿ç”¨è´Ÿæ•°å®ç°
- min_heapï¼ˆå°é¡¶å †ï¼‰ï¼šå­˜å‚¨è¾ƒå¤§çš„ä¸€åŠ
- ä¿æŒä¸¤ä¸ªå †çš„å¤§å°å¹³è¡¡

**addNumæµç¨‹ï¼š**
1. å…ˆå°†numæ·»åŠ åˆ°å¤§é¡¶å †
2. å°†å¤§é¡¶å †çš„æœ€å¤§å€¼ç§»åŠ¨åˆ°å°é¡¶å †
3. è°ƒæ•´ä¸¤ä¸ªå †çš„å¤§å°å¹³è¡¡

**findMedianæµç¨‹ï¼š**
- å¦‚æœå¤§é¡¶å †è¾ƒå¤§ï¼Œä¸­ä½æ•°æ˜¯å¤§é¡¶å †å †é¡¶
- å¦åˆ™ï¼Œä¸­ä½æ•°æ˜¯ä¸¤ä¸ªå †é¡¶çš„å¹³å‡å€¼

**ä¸¾ä¾‹è¯´æ˜ï¼š**
```
åˆå§‹åŒ–ï¼šmax_heap=[], min_heap=[]

addNum(1):
max_heapæ·»åŠ 1ï¼ˆå­˜å‚¨ä¸º-1ï¼‰ï¼Œmax_heap=[-1]
ç§»åŠ¨åˆ°min_heapï¼šmax_heap=[], min_heap=[1]
å¹³è¡¡ï¼šmax_heap=[-1], min_heap=[1]

addNum(2):
max_heapæ·»åŠ 2ï¼ˆ-2ï¼‰ï¼Œmax_heap=[-2,-1]
ç§»åŠ¨åˆ°min_heapï¼šmax_heap=[-1], min_heap=[1,2]
å¹³è¡¡ï¼šä¿æŒç°çŠ¶

findMedian(): (-(-1) + 1) / 2 = 1.5 âœ“

addNum(3):
max_heapæ·»åŠ 3ï¼ˆ-3ï¼‰ï¼Œmax_heap=[-3,-1]
ç§»åŠ¨åˆ°min_heapï¼šmax_heap=[-1], min_heap=[1,2,3]
å¹³è¡¡ï¼šmax_heap=[-3,-1], min_heap=[1,2,3]

findMedian(): -(-3) = 3.0 âœ“
```

**æ—¶é—´å¤æ‚åº¦è¯æ˜ï¼š**
- addNumï¼šO(log n)
- findMedianï¼šO(1)
- æ€»ç©ºé—´ï¼šO(n)

---

## ğŸ¯ å †è§£é¢˜æŠ€å·§æ€»ç»“

### 1. å †çš„åŸºæœ¬æ“ä½œ
```python
import heapq

# å°é¡¶å †
heap = []
heapq.heappush(heap, x)  # æ’å…¥
min_val = heapq.heappop(heap)  # åˆ é™¤æœ€å°å€¼
min_val = heap[0]  # æŸ¥çœ‹æœ€å°å€¼

# å¤§é¡¶å †ï¼ˆä½¿ç”¨è´Ÿæ•°ï¼‰
max_heap = []
heapq.heappush(max_heap, -x)  # æ’å…¥
max_val = -heapq.heappop(max_heap)  # åˆ é™¤æœ€å¤§å€¼
max_val = -max_heap[0]  # æŸ¥çœ‹æœ€å¤§å€¼

# æ‰¹é‡æ“ä½œ
k_largest = heapq.nlargest(k, nums)  # å‰kå¤§
k_smallest = heapq.nsmallest(k, nums)  # å‰kå°
```

### 2. Top Ké—®é¢˜çš„æ¨¡æ¿
```python
def top_k_elements(nums, k):
    """ä½¿ç”¨å°é¡¶å †æ‰¾å‰kå¤§"""
    heap = []
    for num in nums:
        heapq.heappush(heap, num)
        if len(heap) > k:
            heapq.heappop(heap)
    return heap  # heap[0]æ˜¯æœ€å°çš„ï¼Œå³ç¬¬kå¤§çš„

def top_k_frequent(nums, k):
    """å‰kä¸ªé«˜é¢‘å…ƒç´ """
    from collections import Counter
    freq = Counter(nums)
    
    heap = []
    for num, count in freq.items():
        heapq.heappush(heap, (count, num))  # å°é¡¶å †
        if len(heap) > k:
            heapq.heappop(heap)
    
    return [num for count, num in heap]
```

### 3. åŒå †ç»´æŠ¤ä¸­ä½æ•°
```python
class DualHeap:
    def __init__(self):
        self.max_heap = []  # è¾ƒå°çš„ä¸€åŠï¼ˆå¤§é¡¶å †ï¼‰
        self.min_heap = []  # è¾ƒå¤§çš„ä¸€åŠï¼ˆå°é¡¶å †ï¼‰
    
    def add_num(self, num):
        # æ·»åŠ åˆ°è¾ƒå°çš„ä¸€åŠ
        heapq.heappush(self.max_heap, -num)
        # å¹³è¡¡
        heapq.heappush(self.min_heap, -heapq.heappop(self.max_heap))
        # ä¿æŒå¤§å°å¹³è¡¡
        if len(self.min_heap) > len(self.max_heap):
            heapq.heappush(self.max_heap, -heapq.heappop(self.min_heap))
    
    def find_median(self):
        if len(self.max_heap) > len(self.min_heap):
            return -self.max_heap[0]
        else:
            return (-self.max_heap[0] + self.min_heap[0]) / 2
```

### ğŸ’¡ è§£é¢˜æŠ€å·§

1. **å †çš„é€‰æ‹©**ï¼š
   - éœ€è¦æœ€å¤§å€¼ç”¨å¤§é¡¶å †
   - éœ€è¦æœ€å°å€¼ç”¨å°é¡¶å †
   - Top Ké—®é¢˜ç”¨å¤§å°ä¸ºkçš„å°é¡¶å †æˆ–å¤§é¡¶å †

2. **ç©ºé—´ä¼˜åŒ–**ï¼š
   - å †çš„å¤§å°é€šå¸¸æ˜¯O(k)è€Œä¸æ˜¯O(n)
   - åŒå †ç»´æŠ¤ä¸­ä½æ•°ç©ºé—´O(n)

3. **æ—¶é—´å¤æ‚åº¦è€ƒè™‘**ï¼š
   - å †æ“ä½œO(log k)æ¯”æ’åºO(n log n)å¿«
   - é€‚ç”¨äºæ•°æ®é‡å¤§ä½†kç›¸å¯¹è¾ƒå°çš„æƒ…å†µ

4. **è¾¹ç•Œå¤„ç†**ï¼š
   - ç©ºå †ã€ç©ºæ•°ç»„ç­‰è¾¹ç•Œæƒ…å†µ
   - kçš„èŒƒå›´æ£€æŸ¥

å †æ˜¯è§£å†³Top Ké—®é¢˜å’ŒåŠ¨æ€ä¸­ä½æ•°ç»´æŠ¤çš„å¼ºå¤§å·¥å…·ï¼ŒæŒæ¡å †çš„åŸºæœ¬æ“ä½œå’Œåº”ç”¨åœºæ™¯éå¸¸é‡è¦ï¼
